<!DOCTYPE html><html lang="cn"><head><meta charSet="UTF-8"/><title>DSL Practice Guide | Archive</title><meta name="viewport" content="width=device-width, initial-scale=1"/><meta property="og:title" content="DSL Practice Guide | Archive"/><meta name="description" content="Personal Blog"/><meta property="og:description" content="Personal Blog"/><meta property="og:type" content="website"/><meta property="twitter:card" content="summary_large_image"/><link rel="icon" type="image/x-icon" href="/favicon.ico"/><meta name="next-head-count" content="9"/><link data-next-font="" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/blog/_next/static/css/188c649415dfc8d9.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/188c649415dfc8d9.css" data-n-g=""/><link rel="preload" href="/blog/_next/static/css/819e775b5b3a36e7.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/819e775b5b3a36e7.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/blog/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/blog/_next/static/chunks/webpack-0921f57b79154458.js" defer=""></script><script src="/blog/_next/static/chunks/framework-66d32731bdd20e83.js" defer=""></script><script src="/blog/_next/static/chunks/main-8aeaea97487321ec.js" defer=""></script><script src="/blog/_next/static/chunks/pages/_app-ccbaf05611d69494.js" defer=""></script><script src="/blog/_next/static/chunks/29107295-2a9ca7f07685bf37.js" defer=""></script><script src="/blog/_next/static/chunks/814c6784-d7d96a807e1f8484.js" defer=""></script><script src="/blog/_next/static/chunks/664-2906cfc365be3e0b.js" defer=""></script><script src="/blog/_next/static/chunks/158-8b1385307a27c215.js" defer=""></script><script src="/blog/_next/static/chunks/675-dbb4e92c9bdf5be6.js" defer=""></script><script src="/blog/_next/static/chunks/460-c6727053c0ccd6ae.js" defer=""></script><script src="/blog/_next/static/chunks/pages/%5Bcollection%5D/%5B...slug%5D-163f78c8f70614ab.js" defer=""></script><script src="/blog/_next/static/meNayWSLCpwIRBFSyCCZM/_buildManifest.js" defer=""></script><script src="/blog/_next/static/meNayWSLCpwIRBFSyCCZM/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header data-theme="dark" class="style_nav-root__jrAJR" style="height:80px"><section class="style_nav-section__sS_tB"><a class="style_nav-logo__jRYAT" href="/blog"><h3>Allen Lee@Blog</h3></a><nav aria-label="Main" data-orientation="horizontal" dir="ltr" class="style_nav-menus__4aQM9"><div style="position:relative"><ul data-orientation="horizontal" dir="ltr"><li><button class="style_btn__AkQj7 style_subtle__i70rQ style_nav-trigger__ekUye" id="radix-:Rj6:-trigger-radix-:Rjj6:" data-state="closed" aria-expanded="false" aria-controls="radix-:Rj6:-content-radix-:Rjj6:" data-radix-collection-item="">Overview <svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" aria-hidden="true" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.18179 6.18181C4.35753 6.00608 4.64245 6.00608 4.81819 6.18181L7.49999 8.86362L10.1818 6.18181C10.3575 6.00608 10.6424 6.00608 10.8182 6.18181C10.9939 6.35755 10.9939 6.64247 10.8182 6.81821L7.81819 9.81821C7.73379 9.9026 7.61934 9.95001 7.49999 9.95001C7.38064 9.95001 7.26618 9.9026 7.18179 9.81821L4.18179 6.81821C4.00605 6.64247 4.00605 6.35755 4.18179 6.18181Z" fill="currentColor"></path></svg></button></li></ul></div></nav></section></header><main data-theme="light" style="background-color:var(--colorNeutralBackground1);overflow-x:hidden;overflow-y:auto;width:100vw;height:calc(100vh - 80px)" id="main"><div class="collection_slug_Root__xztwf"><div class="main_archivePost__UUdxv zhihu_ZhiHu_Zhuanlan__ef0_j"><div role="article"><h1>DSL Practice Guide</h1><section class="styles_surface__5pQP4 styles_minimum-surface__7A9Os style_references__Vlxnu"><div><span class="style_avatar-root__xEJpL style_avatar__h33HP style_circular__iX_78" role="img"></span><nav><span style="color:#8590a6;font-size:12px">首发于<!-- --> <!-- -->zhuanlan.zhihu</span><a href="https://zhuanlan.zhihu.com/p/107947462">云音乐前端技术团队专栏（郑海波）</a></nav></div><ul role="tree" class="style_tree__LXTUQ" style="flex-grow:1;max-width:200px"><details class="style_item-details__dS91s" role="menu"><summary><div class="style_item___5SwP style_label__b9xu6" role="menuitem"><span class="style_icon-container__VsCy9" style="width:10px"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"></path></svg></span><span class="" data-state="closed"><a class="style_labelItem__D3oKd" href="#" style="overflow:hidden;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:1">目录</a></span></div></summary></details></ul></section><article><figure role="figure"><span class="resp-image-wrapper" style="display:flex;align-items:center;justify-content:center;position:relative"><a target="_blank" rel="noopener" style="display:block" href="/blog/images/archive/v2cb09d892ec78f48e58b918c0b8d4ca23_1200x500.jpg"><img crossorigin="anonymous" alt="header" title=" " loading="lazy" width="1280" height="640" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 1280 640&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAACCAIAAADwyuo0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIklEQVR4nGMwNTUNCQlxd3MTERZhaGlsffvu/caNm9TVNQBogwmIQ14nPQAAAABJRU5ErkJggg==&#x27;/%3E%3C/svg%3E&quot;)" src="/blog/images/archive/v2cb09d892ec78f48e58b918c0b8d4ca23_1200x500.jpg"/></a></span><figcaption role="figcaption"> </figcaption></figure>
<h2 id="前言">前言<a rel="noopener noreferrer external nofollow" target="_blank" href="#前言" class="anchor after" aria-hidden="true" aria-label="permalink" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" focusable="false"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a></h2>
<p>近几年，前端社区中 DSL 这个词开始频繁出镜，这和环境的变化有很大关系：</p>
<ol>
<li>React、Vue、Angular 等现代框架的表现层设计往往和 DSL 有较强的关联，透过这些优秀作品我们可以得到一些实践指引。</li>
<li>前端相关语言的转编译工具链趋于成熟，如 <a rel="noopener noreferrer external nofollow" target="_blank" href="https://babeljs.io/">babel</a>，<a rel="noopener noreferrer external nofollow" target="_blank" href="https://postcss.org/">postcss</a> 等工具可以帮助开发者以扩展插件的方式低成本地参与到语言构建流程中。</li>
<li>社区的解析器生成工具开始普及，如 <a rel="noopener noreferrer external nofollow" target="_blank" href="https://github.com/zaach/jison">jison</a>、<a rel="noopener noreferrer external nofollow" target="_blank" href="https://pegjs.org/">PEG.js</a> 等，可以帮助开发者快速实现全新的编程语言（一般是模板等外部 DSL）。</li>
</ol>
<p>虽然在「术」的实践中我们开始百花齐放，但同时也产生了一些误区或迷思，比如会将 DSL 和转编译这种纯技术议题划上等号，比如会分不清内部 DSL 和库（接口）的边界等等，<strong>DSL</strong> 因此成了一个人人都在说但却又很陌生的词汇。</p>
<p>同时市面上的权威著作如 Martin Fowler 的《领域特定语言》虽然会偏向于「道」的解答，但里面充斥着诸如「格兰特小姐的密室控制器」以及「蹦蹦高证券公司」等等对国内前端开发者而言会水土不服的晦涩案例。实际上前端的日常工作已经和 DSL 有着千丝万缕的关系，作为开发者已经不需要通过这些生涩案例来学习 DSL。</p>
<p>由于篇幅关系，本文会分为三个部分：</p>
<ul>
<li>第一部分：DSL 初识；</li>
<li>第二部分：内部 DSL；</li>
<li>第三部分：外部 DSL + 前端 DSL 实践总结</li>
</ul>
<h2 id="dsl-初识">DSL 初识<a rel="noopener noreferrer external nofollow" target="_blank" href="#dsl-初识" class="anchor after" aria-hidden="true" aria-label="permalink" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" focusable="false"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a></h2>
<blockquote>
<p>和很多计算机领域的概念一样，DSL 其实也算是先有实践再有定义。</p>
</blockquote>
<p>DSL 即「Domain Specific Language」，中文一般译为「领域特定语言」，在<a rel="noopener noreferrer external nofollow" target="_blank" href="https://book.douban.com/subject/21964984/">《领域特定语言》</a>这本书中它有了一个定义：</p>
<blockquote>
<p>一种为<strong>特定领域</strong>设计的，具有<strong>受限表达性</strong>的<strong>编程语言</strong></p>
</blockquote>
<h4 id="编程语言的发展其实是一个不断抽象的过程">编程语言的发展其实是一个不断抽象的过程<a rel="noopener noreferrer external nofollow" target="_blank" href="#编程语言的发展其实是一个不断抽象的过程" class="anchor after" aria-hidden="true" aria-label="permalink" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" focusable="false"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a></h4>
<p>汇编语言通过助记符代替机器指令操作码，极大的增强了机器语言的可读性和可维护性。但本质上它仍是一门面向处理器和寄存器等硬件系统的低级编程语言。高级语言的出现解决了这个问题，真正脱离了对机器指令集的直接关联，以上层抽象的语句(流程控制、循环等)和数据结构等更趋近自然语言和数学公式的方式完成编码工作，大大提升了程序开发的效率。</p>
<p>但在高级语言层面，抽象带来的效率提升似乎有了天花板。无论是从 C 到 Java，抑或是各种编程范式下衍生的抽象度更高的编程语言，解决的都是通用编程问题，它们都有充分的过程抽象和数据抽象，导致大量的概念产生，进而影响了编程效率。</p>
<p>而在一些专有领域的任务处理上其实不需要那么多语言特性，DSL 就是在这种矛盾中产生的破局方案，它是为了解决特定任务的语言工具，比如文档编写有 markdown，字符串匹配有 RegExp，任务控制有 make、gradle，数据查找有 SQL，Web 样式编码有 CSS 等等。它的本质其实和我们很多软件工程问题的解决思路一样，<strong>通过限定问题域边界，从而锁定复杂度，提高编程效率</strong>。</p>
<p>先来个简单的例子，比如表示<em>2 周前的时间</em>：</p>
<p><strong>解法一</strong></p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">7</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p><strong>解法二</strong></p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token number">2</span> weeks ago
</span></code></pre>
<p><strong>解法三</strong></p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">weeks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">ago</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>解法一是符合通用编程思维的解答，但即使作为程序员的我们也无法一眼看出其含义。</p>
<p>解法二和解法三其实就是 DSL 的两种不同类型——<strong>外部 DSL</strong>和<strong>内部 DSL</strong>，其直观性显然更高，但可惜无法直接运行。假如尝试在 JavaScript 环境下运行，将会获得完全不同的错误：</p>
<ul>
<li>2 weeks ago 会得到 <code>Uncaught SyntaxError: Unexpected identifier</code> 的<strong>语法错误</strong>。</li>
<li>(2).weeks().ago() 则会得到一个 <code>Uncaught TypeError: 2.weeks is not a function</code> 的运行时<strong>类型错误</strong>。</li>
</ul>
<blockquote>
<p>其实从错误类型上我们就可以看到它们是有本质不同的。</p>
</blockquote>
<h4 id="外部-dsl">外部 DSL<a rel="noopener noreferrer external nofollow" target="_blank" href="#外部-dsl" class="anchor after" aria-hidden="true" aria-label="permalink" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" focusable="false"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a></h4>
<p>解法二称之为<strong>外部 DSL</strong>，它是一种<strong>独立的编程语言</strong>，需要从解析器开始实现自己的编译工具，实现成本较高。但它的语法的灵活性更高，更容易达到用户的表现力需求。</p>
<p>外部 DSL 的直接对应就是 GPPL，由于受限语法特性更少，一般不要求图灵完备，所以它实现难度会低于 GPPL。</p>
<blockquote>
<p>GPPL 即 「General Purpose Programming Language」，又称通用编程语言，例如我们常用的 JavaScript，它们被设计用来解决通用编程问题。</p>
</blockquote>
<p>前端常用的模板引擎如 <a rel="noopener noreferrer external nofollow" target="_blank" href="http://mustache.github.io/">mustache</a> 以及 React、Vue 支持的 JSX 语法都属于外部 DSL。
mustache 的例子：</p>
<pre class="language-html"><code class="language-html code-highlight"><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>Names<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">{{#names}}
</span><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>{{name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span>
</span><span class="code-line">{{/names}}
</span></code></pre>
<h4 id="内部-dsl">内部 DSL<a rel="noopener noreferrer external nofollow" target="_blank" href="#内部-dsl" class="anchor after" aria-hidden="true" aria-label="permalink" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" focusable="false"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a></h4>
<p>解法三我们称之为 <strong>内部 DSL（Embedded DSL or Internal DSL）</strong>，是建立在其它宿主语言之上（GPPL）的特殊 DSL，它与宿主语言共享编译与调试工具等基础设施，学习成本更低，也更容易被集成。他在语法上与宿主语言同源，但在运行时上需要做额外的封装。</p>
<blockquote>
<p>你也可以将内部 DSL 视为针对特定任务的特殊接口封装风格，比如 jQuery 就可以认为是针对 DOM 操作的一种内部 DSL。</p>
</blockquote>
<p>内部 DSL 的语法灵活度和语法噪音（syntactic noise）往往取决于宿主语言的选择，本篇的例子我们会围绕 JavaScript 来展开。</p>
<blockquote>
<p><strong>syntactic noise</strong> is syntax within a programming language that makes the programming language more difficult to read and understand for humans.</p>
</blockquote>
<p>最后我们来看下内部 DSL 以及外部 DSL 与一般通用语言 GPPL 的关系：
</p>
<figure role="figure"><span class="resp-image-wrapper" style="display:flex;align-items:center;justify-content:center;position:relative"><a target="_blank" rel="noopener" style="display:block" href="/blog/images/archive/GPPLandInternalDSL,outerDSL.jpg"><img crossorigin="anonymous" alt="Pixlr_20191217155208460.jpg" title=" " loading="lazy" width="720" height="328" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 720 328&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAACCAIAAADwyuo0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAI0lEQVR4nGM4cuRodnbB3XtPX7/9wyAoJGlqbpeZU9HaNhUAvRIM29qM3IsAAAAASUVORK5CYII=&#x27;/%3E%3C/svg%3E&quot;)" src="/blog/images/archive/GPPLandInternalDSL,outerDSL.jpg"/></a></span><figcaption role="figcaption"> </figcaption></figure>
<h2 id="内部-dsl-1">内部 DSL<a rel="noopener noreferrer external nofollow" target="_blank" href="#内部-dsl-1" class="anchor after" aria-hidden="true" aria-label="permalink" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" focusable="false"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a></h2>
<p>结合 JavaScript 构建内部 DSL 其实有一些可套用的风格可循。</p>
<h4 id="风格-1级联方法">风格 1：级联方法<a rel="noopener noreferrer external nofollow" target="_blank" href="#风格-1级联方法" class="anchor after" aria-hidden="true" aria-label="permalink" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" focusable="false"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a></h4>
<p>级联方法是内部 DSL 的最常用模式，我们先以原生 DOM 操作作为反面案例：</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token keyword">const</span> userPanel <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#user_panel&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">userPanel<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> hidePanel<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token function">slideDown</span><span class="token punctuation">(</span>userPanel<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//假设这是一个已实现的动画封装</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> followButtons <span class="token operator">=</span> userPanel<span class="token punctuation">.</span><span class="token method function property-access">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot;button&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">followButtons<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  node<span class="token punctuation">.</span><span class="token property-access">innerHTML</span> <span class="token operator">=</span> <span class="token string">&quot;follow&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>相信大家很难一眼看出做了什么，但假如我们使用远古框架 jQuery 来实现等价效果：</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#user_panel&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">click</span><span class="token punctuation">(</span>hidePanel<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">slideDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">find</span><span class="token punctuation">(</span><span class="token string">&quot;button&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">html</span><span class="token punctuation">(</span><span class="token string">&quot;follow&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>就很容易理解其中的含义：</p>
<ol>
<li>找到 #user_panel 节点；</li>
<li>设置点击后隐藏它；</li>
<li>向下动效展开；</li>
<li>然后找到它下面的所有 button 节点；</li>
<li>为这些按钮填充 follow 内容。</li>
</ol>
<p>级联方法等链式调用风格的核心在于<strong>调用不再设计特定返回值，而是直接返回下一个上下文（通常是自身）</strong>，从而实现级联调用。</p>
<h4 id="风格-2级联管道">风格 2：级联管道<a rel="noopener noreferrer external nofollow" target="_blank" href="#风格-2级联管道" class="anchor after" aria-hidden="true" aria-label="permalink" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" focusable="false"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a></h4>
<p>级联管道只是一种级联方法的特殊应用，代表案例就是 gulp：</p>
<blockquote>
<p><a rel="noopener noreferrer external nofollow" target="_blank" href="https://gulpjs.com/">gulp</a> 是一种类似 make 构建任务管理工具，它将文件抽象为一种叫 <a rel="noopener noreferrer external nofollow" target="_blank" href="https://github.com/gulpjs/vinyl">Vinyl</a>(Virtual file format) 的类型，抽象文件使用 pipe 方法依次通过 transformer 从而完成任务。</p>
</blockquote>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line">gulp
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">src</span><span class="token punctuation">(</span><span class="token string">&quot;./scss/**/*.scss&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">pipe</span><span class="token punctuation">(</span><span class="token function">plumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">pipe</span><span class="token punctuation">(</span><span class="token function">sass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">pipe</span><span class="token punctuation">(</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">suffix</span><span class="token operator">:</span> <span class="token string">&quot;.min&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">pipe</span><span class="token punctuation">(</span><span class="token function">postcss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">pipe</span><span class="token punctuation">(</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">&quot;./css&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>其设计哲学是衍生自 Unix 命令行中的管道，上例可以直接类比以下命令：</p>
<pre class="language-shell"><code class="language-shell code-highlight"><span class="code-line"><span class="token function">cat</span> <span class="token string">&#x27;./scss/**/*.scss&#x27;</span> <span class="token operator">|</span> plumber <span class="token operator">|</span> sass <span class="token operator">|</span> <span class="token function">rename</span> <span class="token parameter variable">--suffix</span> <span class="token string">&#x27;.min&#x27;</span> <span class="token operator">|</span> postcss <span class="token operator">|</span> dest <span class="token string">&#x27;./css/&#x27;</span>
</span></code></pre>
<p>上述针对 Pipeline 的抽象也有用常规级联调用的方式来构建 DSL，比如 <a rel="noopener noreferrer external nofollow" target="_blank" href="https://github.com/chajs/cha">chajs</a>：</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token function">cha</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">in</span><span class="token punctuation">(</span><span class="token string">&quot;glob&quot;</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;task-glob&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">in</span><span class="token punctuation">(</span><span class="token string">&quot;combine&quot;</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;task-combine&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">in</span><span class="token punctuation">(</span><span class="token string">&quot;replace&quot;</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;task-replace&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">glob</span><span class="token punctuation">(</span><span class="token string">&quot;./scss/**/*.scss&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">plumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">sass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">rename</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">suffix</span><span class="token operator">:</span> <span class="token string">&quot;.min&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">postcss</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">dest</span><span class="token punctuation">(</span><span class="token string">&quot;./css&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>由于减少了多个 <code>pipe</code>，代码显然是有减少的，但流畅度上并没有更大的提升。</p>
<p>其次 <code>chajs</code> 的风格要求这些扩展方法都注册到实例中，这就平添了集成成本，这些集成代码也会影响到 DSL 的流畅度。相比之下，<code>gulp</code> 将扩展统一抽象为一种外部 <code>transformer</code>，显然设计的更加优雅。</p>
<h4 id="风格-3级联属性">风格 3：级联属性<a rel="noopener noreferrer external nofollow" target="_blank" href="#风格-3级联属性" class="anchor after" aria-hidden="true" aria-label="permalink" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" focusable="false"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a></h4>
<p>级联方法如文章开篇的 <code>(2).weeks().ago()</code>，其实还不够简洁，存在明显的语法噪音，<code>(2).weeks.ago</code>显然是个更好的方式，我们可以通过属性静态代理来实现，核心就是 <code>Object.defineProperty()</code>，它可以劫持属性的 <code>setter</code> 与 <code>getter</code>：</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token keyword">const</span> hours <span class="token operator">=</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">const</span> days <span class="token operator">=</span> hours <span class="token operator">*</span> <span class="token number">24</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">const</span> weeks <span class="token operator">=</span> days <span class="token operator">*</span> <span class="token number">7</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token keyword">const</span> <span class="token constant">UNIT_TO_NUM</span> <span class="token operator">=</span> <span class="token punctuation">{</span> hours<span class="token punctuation">,</span> days<span class="token punctuation">,</span> weeks <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">class</span> <span class="token class-name">Duration</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">num<span class="token punctuation">,</span> unit</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">number</span> <span class="token operator">=</span> num<span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">unit</span> <span class="token operator">=</span> unit<span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token function">toNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword control-flow">return</span> <span class="token constant">UNIT_TO_NUM</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">unit</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">number</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token keyword">get</span> <span class="token function">ago</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">toNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token keyword">get</span> <span class="token function">later</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token known-class-name class-name">Date</span><span class="token punctuation">.</span><span class="token method function property-access">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">toNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line"><span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">keys</span><span class="token punctuation">(</span><span class="token constant">UNIT_TO_NUM</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">unit</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token known-class-name class-name">Object</span><span class="token punctuation">.</span><span class="token method function property-access">defineProperty</span><span class="token punctuation">(</span><span class="token class-name">Number</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">,</span> unit<span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token keyword control-flow">return</span> <span class="token keyword">new</span> <span class="token class-name">Duration</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> unit<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">//console.log( (2).weeks.ago )</span>
</span></code></pre>
<p>可以看到级联属性可以比级联方法拥有更简洁的表述，但同时也丢失了参数层面的灵活性。</p>
<p>在 DSL 风格中，无论是级联方法、级联管道还是级联属性，本质都是链式调用风格，链式调用的核心是上下文传递，所以<strong>每一次调用的返回实体是否符合用户的心智</strong>是 DSL 设计是否成功的重要依据。</p>
<h4 id="风格-4嵌套函数">风格 4：嵌套函数<a rel="noopener noreferrer external nofollow" target="_blank" href="#风格-4嵌套函数" class="anchor after" aria-hidden="true" aria-label="permalink" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" focusable="false"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a></h4>
<p>开发中也存在一些层级抽象的场景，比如 DOM 树的生成，纯粹命令式使用 DOM API 来构建的写法略显晦涩，很难一眼看出最终的 HTML 结构，那如何构建内部 DSL 来流畅解决这种层级抽象呢？</p>
<p>有人就尝试用类似链式调用的方式去实现，比如 <a rel="noopener noreferrer external nofollow" target="_blank" href="https://github.com/hoho/concat.js">concat.js</a>：</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token function">builder</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">div</span><span class="token punctuation">(</span><span class="token string">&quot;#container&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">h1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">text</span><span class="token punctuation">(</span><span class="token string">&quot;This is hyperscript&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">ul</span><span class="token punctuation">(</span><span class="token punctuation">{</span> title <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">li</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">a</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">href</span><span class="token operator">:</span> <span class="token string">&quot;abc.com&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">text</span><span class="token punctuation">(</span><span class="token string">&quot;One list item&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">li</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">text</span><span class="token punctuation">(</span><span class="token string">&quot;Another list item&quot;</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>这似乎比命令式的写法好了不少，但构建这种 DSL 存在不少问题：</p>
<ol>
<li>因为链式调用的关键是上下文传递，在层级抽象中需额外的 end() 出栈动作实现上下文切换。</li>
<li>可读性强依赖于手动缩进，而编辑器的自动缩进往往会打破这种和谐。</li>
</ol>
<p>所以一般层级结构抽象很少使用链式调用风格来构建 DSL，而会更多的使用基本的<strong>嵌套函数</strong>来实现。</p>
<p>我们以另一个骨灰开源项目 <a rel="noopener noreferrer external nofollow" target="_blank" href="https://github.com/insin/DOMBuilder">DOMBuilder</a> 为例：</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token keyword">with</span><span class="token punctuation">(</span><span class="token maybe-class-name">DOMBuilder</span><span class="token punctuation">.</span><span class="token property-access">dom</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">//这里先抛开 with 本身的使用问题</span>
</span><span class="code-line">  <span class="token keyword">const</span> node <span class="token operator">=</span>
</span><span class="code-line">    <span class="token function">div</span><span class="token punctuation">(</span><span class="token string">&#x27;#container&#x27;</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token function">h1</span><span class="token punctuation">(</span><span class="token string">&#x27;This is hyperscript&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">      <span class="token function">ul</span><span class="token punctuation">(</span><span class="token punctuation">{</span>title<span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token function">li</span><span class="token punctuation">(</span>
</span><span class="code-line">            <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">herf</span><span class="token operator">:</span><span class="token string">&#x27;abc.com&#x27;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&#x27;One list item&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token punctuation">)</span><span class="token punctuation">,</span>
</span><span class="code-line">        <span class="token function">li</span><span class="token punctuation">(</span><span class="token string">&#x27;Another list item&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">)</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>可以看到层级结构抽象使用嵌套函数来实现会更流畅。</p>
<p>如果使用 CoffeeScript 来描述，语法噪音可以降到更低，可以接近 pug 这种外部 DSL 的语法：</p>
<pre class="language-pug"><code class="language-pug code-highlight"><span class="code-line"><span class="token tag">div</span> <span class="token plain-text">&#x27;#container&#x27;,</span>
</span><span class="code-line">  <span class="token tag">h1</span> <span class="token plain-text">&#x27;This is hyperscript&#x27;</span>
</span><span class="code-line">  <span class="token tag">ul</span> <span class="token plain-text">{title},</span>
</span><span class="code-line">    <span class="token tag">li</span>(
</span><span class="code-line">      <span class="token tag">a</span> <span class="token plain-text">href:&#x27;abc.com&#x27;, &#x27;One list item&#x27;</span>
</span><span class="code-line">    )
</span><span class="code-line">    <span class="token tag">li</span> <span class="token plain-text">&#x27;Another list item&#x27;</span>
</span></code></pre>
<p>嵌套函数本质上是将在链式调用中需要处理的上下文切换隐含在了函数嵌套操作中，所以它在层级抽象场景是非常适用的。</p>
<p>另外，嵌套函数在 DSL 的应用类似解析树，因为其符合语法树生成思路，往往可直接映射转换为对应外部 DSL，比如 JSX：</p>
<pre class="language-jsx"><code class="language-JSX code-highlight"><span class="code-line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#x27;</span>container<span class="token punctuation">&#x27;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&#x27;</span>heading<span class="token punctuation">&#x27;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> This is hyperscript </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">title</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>title<span class="token punctuation">}</span></span> <span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>href<span class="token punctuation">}</span></span> <span class="token punctuation">&gt;</span></span><span class="token plain-text"> One list item </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text"> Another list item </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text">  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span></span><span class="code-line"><span class="token plain-text"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</span></code></pre>
<p>嵌套函数并不是万金油，它天然不适合流程、时间等顺序敏感的场景。</p>
<p>例如，如果将风格 2 的级联管道修改为嵌套函数：
</p>
<figure role="figure"><span class="resp-image-wrapper" style="display:flex;align-items:center;justify-content:center;position:relative"><a target="_blank" rel="noopener" style="display:block" href="/blog/images/archive/nestedFuctionsInProcessAbsctractionExample.jpg"><img crossorigin="anonymous" alt="嵌套函数在流程抽象的应用范例" title="嵌套函数在流程抽象的应用范例" loading="lazy" width="480" height="406" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 480 406&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAIAAAA7ljmRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAMElEQVR4nGP4+u3/j7//wyLSjUydGRpaJk+evtTSxkNCWp1BQFiBT0iOnUtaU8cKAGlWDVfAtvkxAAAAAElFTkSuQmCC&#x27;/%3E%3C/svg%3E&quot;)" src="/blog/images/archive/nestedFuctionsInProcessAbsctractionExample.jpg"/></a></span><figcaption role="figcaption">嵌套函数在流程抽象的应用范例</figcaption></figure>
<p>执行逻辑与阅读顺序显然不一致，并且会加重书写负担(同时要关心开闭逻辑)，极大影响读写流畅度。</p>
<h4 id="风格-5对象字面量">风格 5：对象字面量<a rel="noopener noreferrer external nofollow" target="_blank" href="#风格-5对象字面量" class="anchor after" aria-hidden="true" aria-label="permalink" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" focusable="false"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a></h4>
<p>业界很多 DSL 都类似于配置文件，例如 <a rel="noopener noreferrer external nofollow" target="_blank" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON">JSON</a>、<a rel="noopener noreferrer external nofollow" target="_blank" href="https://yaml.org/">YAML</a> 等外部 DSL，它们在嵌套数据展现中有很强的表达力。</p>
<p>而 JavaScript 也有一个适合在此场景构建 DSL 的特性，那就是字面量对象，实际上，JSON（全称 JavaScript Object Notation）正是衍生自它的这个特性，成为了一种标准数据交换格式。</p>
<p>例如在项目 <a rel="noopener noreferrer external nofollow" target="_blank" href="https://github.com/leeluolee/puer">puer</a> 中，路由配置文件选择了 JS 的对象字面量而不是 JSON：</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token string-property property">&#x27;GET /homepage&#x27;</span><span class="token operator">:</span> <span class="token string">&#x27;./view/static.html&#x27;</span>
</span><span class="code-line">    <span class="token string-property property">&#x27;GET /blog&#x27;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-line">        <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#x27;Hello&#x27;</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">    <span class="token string-property property">&#x27;GET /user/:id&#x27;</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token arrow operator">=&gt;</span><span class="token punctuation">{</span>
</span><span class="code-line">        res<span class="token punctuation">.</span><span class="token method function property-access">render</span><span class="token punctuation">(</span><span class="token string">&#x27;user.vm&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span></code></pre>
<p>因为 JSON 有一个天然缺陷就是要求可序列化，这极大的限制了它的表达力（不过也使它成为了最流行的跨语言数据交换格式），比如上例最后一条还引入了函数，虽然从 DSL 角度来说变得“不纯粹”了，但功能性却上了一个台阶。这也是为什么一些构建任务相关的 DSL（make、rake、cake、gradle 等）几乎全部都是内部 DSL 的原因。</p>
<p>除此之外，因为对象 key 值的存在，对象字面量也能提高参数可读性，比如：</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token function">div</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token string">&#x27;container&#x27;</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#x27;This is a tip&#x27;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// CoffeeScript Version</span>
</span><span class="code-line">div id<span class="token operator">:</span> <span class="token string">&#x27;container&#x27;</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#x27;This is a tip&#x27;</span>
</span></code></pre>
<p>显然比用词更少的下例可读性更佳：</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token function">div</span><span class="token punctuation">(</span><span class="token string">&quot;container&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;This is a tip&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<blockquote>
<p>构造 DSL 并非越简洁越好，提高流畅度才是关键。</p>
</blockquote>
<p>对象字面量的结构性较强，一般只用来做配置等数据抽象的场景，不适合用在过程抽象的场景。</p>
<h4 id="风格-6动态代理">风格 6：动态代理<a rel="noopener noreferrer external nofollow" target="_blank" href="#风格-6动态代理" class="anchor after" aria-hidden="true" aria-label="permalink" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" focusable="false"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a></h4>
<p>之前所列举内部 DSL 的构造方式有一个典型缺陷就是它们都是静态定义的属性或方法，没有动态性。</p>
<p>如上节 <strong>[风格 4: 嵌套函数]</strong> 中的提到 concat.js，它的所有类似 div、p 等方法都是<a rel="noopener noreferrer external nofollow" target="_blank" href="https://github.com/hoho/concat.js/blob/master/concat.js#L22">静态具名定义的</a>。而实际上因为 <a rel="noopener noreferrer external nofollow" target="_blank" href="https://developer.mozilla.org/zh-CN/docs/Web/Web_Components/Using_custom_elements">custom elements</a> 特性的存在，这种静态穷举的方式显然是有坑的，更别说 html 标准本身也在不断增加新标签。</p>
<p>而在外部 DSL，这个问题是不存在的。那么内部 DSL 要怎么实现呢？若内部 DSL 要实现这种特性，就强依赖宿主语言的元编程能力了。 Ruby 作为典型宿主语言经常会用来证明其强大元编程能力的特性就是 <a rel="noopener noreferrer external nofollow" target="_blank" href="https://www.leighhalliday.com/ruby-metaprogramming-method-missing">method_missing</a>，这个方法可以动态接收所有未定义的方法，最直接功能就是动态命名方法（或元方法），这样就可以解决上面提到的内部 DSL 都是具名静态定义的问题。</p>
<p>值得庆幸的是在 JavaScript 中也有了一个更强大的语言特性，就是 <a rel="noopener noreferrer external nofollow" target="_blank" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy">Proxy</a>，它可以代理属性获取，从而解决上文的穷举问题。</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token comment">// 用于演示，非完整代码</span>
</span><span class="code-line"><span class="token keyword">function</span> <span class="token function">tag</span><span class="token punctuation">(</span><span class="token parameter">tagName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">tag</span><span class="token operator">:</span> tagName <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> property<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword control-flow">return</span> tag<span class="token punctuation">.</span><span class="token method function property-access">bind</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">,</span> property<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">builder<span class="token punctuation">.</span><span class="token method function property-access">h1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {tag: &#x27;h1&#x27;}</span>
</span><span class="code-line">builder<span class="token punctuation">.</span><span class="token method function property-access">tag_not_defined</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {tag: &#x27;tag_not_defined&#x27;}</span>
</span></code></pre>
<p>Proxy 使得 JavaScript 具备了极强的元编程能力，它除了可以轻松<a rel="noopener noreferrer external nofollow" target="_blank" href="https://www.cnblogs.com/htoooth/p/11367829.html">模拟出 Ruby 中的 method_missing 特性</a>外，也可以有很多<a rel="noopener noreferrer external nofollow" target="_blank" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy#%E4%B8%80%E4%B8%AA%E5%AE%8C%E6%95%B4%E7%9A%84_traps_%E5%88%97%E8%A1%A8%E7%A4%BA%E4%BE%8B">其它动态代理能力</a>，这些都是实现内部 DSL 的重要工具。</p>
<h4 id="风格-7lambda-表达式">风格 7：Lambda 表达式<a rel="noopener noreferrer external nofollow" target="_blank" href="#风格-7lambda-表达式" class="anchor after" aria-hidden="true" aria-label="permalink" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" focusable="false"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a></h4>
<p>市面上有大量的查询库使用链式风格，它们非常接近 SQL 本身的写法，比如：</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token maybe-class-name">User</span><span class="token punctuation">.</span><span class="token method function property-access">select</span><span class="token punctuation">(</span><span class="token string">&#x27;name&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">where</span><span class="token punctuation">(</span><span class="token string">&#x27;id==1&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">where</span><span class="token punctuation">(</span><span class="token string">&#x27;age &gt; 1&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">sortBy</span><span class="token punctuation">(</span><span class="token string">&#x27;create_time&#x27;</span><span class="token punctuation">)</span>
</span></code></pre>
<p>为了将 id==1 等表达式转化为可运行的过滤条件，我们不得不去实现完整的表达式解析器，以最终编译得到等价函数。</p>
<p>这样做的实现成本非常高，而使用 lambda 表达式可以更低成本地解决这种需求</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token maybe-class-name">User</span><span class="token punctuation">.</span><span class="token method function property-access">select</span><span class="token punctuation">(</span><span class="token string">&#x27;name&#x27;</span><span class="token punctuation">)</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">where</span><span class="token punctuation">(</span><span class="token parameter">user</span> <span class="token arrow operator">=&gt;</span> user<span class="token punctuation">.</span><span class="token property-access">id</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">where</span><span class="token punctuation">(</span><span class="token parameter">user</span> <span class="token arrow operator">=&gt;</span> user<span class="token punctuation">.</span><span class="token property-access">age</span> <span class="token operator">&gt;</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">  <span class="token punctuation">.</span><span class="token method function property-access">sortBy</span><span class="token punctuation">(</span><span class="token string">&#x27;create_time&#x27;</span><span class="token punctuation">)</span>
</span></code></pre>
<p>这种应用案例其实早就存在了，比如基于 C#的<a rel="noopener noreferrer external nofollow" target="_blank" href="https://docs.microsoft.com/en-us/dotnet/csharp/linq/">LINQ(Language-Integrated Query)</a>，这也是最常活跃在内部 DSL 技术圈的典型案例。</p>
<pre class="language-csharp"><code class="language-csharp code-highlight"><span class="code-line"><span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> products
</span><span class="code-line">    <span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>UnitPrice <span class="token operator">&gt;=</span> <span class="token number">20</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">.</span><span class="token function">GroupBy</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>CategoryName<span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">.</span><span class="token function">OrderByDescending</span><span class="token punctuation">(</span>g <span class="token operator">=&gt;</span> g<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    <span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>g <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> g<span class="token punctuation">.</span>Key<span class="token punctuation">,</span> Count <span class="token operator">=</span> g<span class="token punctuation">.</span><span class="token function">Count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>Lambda 表达式本质上是一种直观易读且<strong>延迟执行</strong>的逻辑表达能力，从而避免额外的解析工作，不过它强依托宿主的语言特性支持(匿名函数 + 箭头表示)，并且也会引入一定的语法噪音。</p>
<h4 id="风格-8自然语言抽象">风格 8：自然语言抽象<a rel="noopener noreferrer external nofollow" target="_blank" href="#风格-8自然语言抽象" class="anchor after" aria-hidden="true" aria-label="permalink" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" focusable="false"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a></h4>
<p>自然语言抽象即以更贴近自然语言的方式去设计 DSL 的语法，它行得通的基本逻辑是领域专家基本都是和你我一样的自然人，更容易接受自然语言的语法。</p>
<p>自然语言抽象的本质是一些语法糖，和一般 GPPL 的语法糖不一样， DSL 的语法糖并不一定是最简洁的，反而会加入一些「冗余」的非功能性语法词汇。</p>
<p>通过自然语言抽象，内部 DSL 的优势在单元测试场景中被发挥的淋漓尽致，比如如果我们裸用类似 <a rel="noopener noreferrer external nofollow" target="_blank" href="http://nodejs.cn/api/assert.html#assert_assert_value_message">assert</a> 的断言方法，单元测试用例可能是这样的：</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token string">&quot;43&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token function">assert</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> foo <span class="token operator">===</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;expect foo to be a number&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line"><span class="token function">assert</span><span class="token punctuation">(</span>
</span><span class="code-line">  tea<span class="token punctuation">.</span><span class="token property-access">flavors</span> <span class="token operator">&amp;&amp;</span> tea<span class="token punctuation">.</span><span class="token property-access">flavors</span><span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">,</span>
</span><span class="code-line">  <span class="token string">&quot;c should have property flavors with length of 3&quot;</span>
</span><span class="code-line"><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>有几个显著待优化的问题：</p>
<ol>
<li>命令式的断言语句阅读不直观；</li>
<li>为了 report 的可读性，需要传入额外的提示语（如 expect foo to be a number）。</li>
</ol>
<p>如果这个 case 基于 chai 来书写的话，可读性会立马上一个台阶：</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token string">&quot;43&quot;</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">// AssertionError: &#x27;43&#x27; should be a &#x27;number&#x27;.</span>
</span><span class="code-line">foo<span class="token punctuation">.</span><span class="token property-access">should</span><span class="token punctuation">.</span><span class="token property-access">be</span><span class="token punctuation">.</span><span class="token method function property-access">a</span><span class="token punctuation">(</span><span class="token string">&quot;number&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line">tea<span class="token punctuation">.</span><span class="token property-access">should</span><span class="token punctuation">.</span><span class="token property-access">have</span><span class="token punctuation">.</span><span class="token method function property-access">property</span><span class="token punctuation">(</span><span class="token string">&quot;flavors&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">with</span><span class="token punctuation">.</span><span class="token method function property-access">lengthOf</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre>
<p>可以发现测试用例变得更加易读易写了，而且当断言失败，也会自动根据链式调用产生的状态，自动拼装出更友好的错误信息。</p>
<h4 id="总结">总结<a rel="noopener noreferrer external nofollow" target="_blank" href="#总结" class="anchor after" aria-hidden="true" aria-label="permalink" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" focusable="false"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a></h4>
<p>本文并未囊括所有内部 DSL 实现风格(比如也有些基于 Decorator 装饰器的玩法)，且所列风格都不是银弹，都有其适用场景，它们之间存在互补效应。
</p>
<figure role="figure"><span class="resp-image-wrapper" style="display:flex;align-items:center;justify-content:center;position:relative"><a target="_blank" rel="noopener" style="display:block" href="/blog/images/archive/internalDSLCompare.jpg"><img crossorigin="anonymous" alt="所列举的内部DSL构建风格对比简表" loading="lazy" width="720" height="348" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 720 348&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAACCAIAAADwyuo0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAI0lEQVR4nGNwc3PT1taZPXt2XV0dg7a2TmJi4uzZs3fv3g0AcW8KR9/Jjq0AAAAASUVORK5CYII=&#x27;/%3E%3C/svg%3E&quot;)" src="/blog/images/archive/internalDSLCompare.jpg"/></a></span><figcaption role="figcaption">所列举的内部DSL构建风格对比简表</figcaption></figure>
<p>通过上面的一些惯用风格的介绍，我们建立了对前端内部 DSL 的一些了解，以下再针对「Why」的问题做下深入讨论：</p>
<h5 id="js-why">JS, why?<a rel="noopener noreferrer external nofollow" target="_blank" href="#js-why" class="anchor after" aria-hidden="true" aria-label="permalink" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" focusable="false"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a></h5>
<p>从风格案例可以看到，<strong>宿主语言直接决定了内部 DSL 的「语法」优化的上限</strong>。正如 ROR 之于 Ruby、Gradle 之于 Groovy，典型的前期选择大于后天努力。而前端开发最趁手的语言 JavaScript 其实在构建内部 DSL 时具备了很大的优势：</p>
<ul>
<li>借鉴 Java 语言的数据类型和内存管理，抽象度高。</li>
<li>基于对象，且拥有方便的对象字面量表示等，数据表达力一流。</li>
<li>函数为第一等公民（first class），可以有一些泛 FP 的应用。</li>
<li>使用基于原型（prototype）的继承机制，并且可扩展原始类型如 Number。</li>
<li>Proxy、Reflect 等新特性加持下具备了极强的元编程能力。</li>
</ul>
<p>但要注意的是，JavaScript 存在的天然缺陷就是它那衍生自 C 的语法，导致噪音较强，使用一些变种语言（如 CoffeeScript）可以扭转一些这种劣势。</p>
<h5 id="库接口还是内部-dsl">库（接口）还是内部 DSL<a rel="noopener noreferrer external nofollow" target="_blank" href="#库接口还是内部-dsl" class="anchor after" aria-hidden="true" aria-label="permalink" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" focusable="false"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a></h5>
<p>外部 DSL 的边界问题往往是 DSL 与 GPPL 的区别，这个在社区中的争议并不算很大。而关于内部 DSL 的讨论，特别是与库（接口）的差异问题就一直都没消停过，确实存在模糊的部分。</p>
<p>实际上 DSL 也有个别名叫<strong>流畅接口</strong>，所以它本身也属于接口封装或库封装的一种模式，目标是极限表达力。但它相较于传统接口封装，有几个显著设计差异点：</p>
<ul>
<li>语言性。</li>
<li>不受传统编程最佳实践的束缚：如命令-查询分离、迪米特法则等。</li>
</ul>
<p>比如在内部 DSL 中，得到代码如 <code>foo.should.be.a.number</code> 就像是一个在既定语法下有关联的整句，而不是命令式代码的集合。而 jQuery 中 html 既是查询方法（<code>.html()</code>）也是命令方法（<code>.html(&#x27;content to set&#x27;)</code>），这显然背离了命令查询分离的原则。它们设计的首要目标是「极限流畅的表现力」，而非职责清晰、降低耦合度等传统的封装抽象准则。</p>
<blockquote>
<p>如松本行弘先生在<a rel="noopener noreferrer external nofollow" target="_blank" href="https://book.douban.com/subject/24536403/">《代码的未来》</a>中引述的观点，也算是该问题的一个解答：<strong>库设计就是语言设计</strong></p>
</blockquote>
<p><strong>编程语言只确定了基本语法框架和少量词汇，库设计应该将其与充当词汇池的类、方法、属性甚至变量相结合，并将它们按语义有机结合</strong>，最终真正实现「在限定任务下，编程工作者只需要关注 What，而无需关注 How」的设计目标。这也就是 <code>(2).weeks.ago</code> 的魔力所在，编程（语言）的发展方向就应该如此，才能达到更高的抽象维度。</p>
<p>所以与其尝试去为内部 DSL 划分一个明确的边界，不如根据它的要求去改善你的接口设计。这里引申另一个更激进的观点：</p>
<blockquote>
<p><strong>Programming is a process of designing DSL for your own application.</strong></p>
</blockquote>
<h4 id="内部-dsl-实践的一些坑">内部 DSL 实践的一些坑<a rel="noopener noreferrer external nofollow" target="_blank" href="#内部-dsl-实践的一些坑" class="anchor after" aria-hidden="true" aria-label="permalink" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" focusable="false"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a></h4>
<p>除了由于依赖于宿主语言，导致功能性缺失和额外的语法噪音之外，内部 DSL 也存在其它不可忽视的问题。</p>
<h5 id="不友好的异常">不友好的异常<a rel="noopener noreferrer external nofollow" target="_blank" href="#不友好的异常" class="anchor after" aria-hidden="true" aria-label="permalink" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" focusable="false"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a></h5>
<p>在 <strong>[风格 3: 级联属性]</strong> 的案例中，其实我们没有定义 <code>minutes</code> 这个单位, 如果错误的使用<code>(5).minutes.later</code>，将得到以下错误提示：</p>
<pre class="language-shell"><code class="language-shell code-highlight"><span class="code-line">Uncaught TypeError: Cannot <span class="token builtin class-name">read</span> property <span class="token string">&#x27;later&#x27;</span> of undefined
</span></code></pre>
<p>而不是我们预期的类似报错信息：</p>
<pre class="language-shell"><code class="language-shell code-highlight"><span class="code-line">Uncaught SyntaxError: Unexpected unit minutes
</span></code></pre>
<p>这是由于异常处理机制也遵循宿主语言，在库封装层面做 DSL 抽象依然无法逃脱这个限制，这也是外部 DSL 的优势所在，不过基于 <strong>[风格 6：动态代理]</strong> 提到的 Proxy，我们仍能做一些微不足道的小优化：</p>
<pre class="language-js"><code class="language-js code-highlight"><span class="code-line"><span class="token keyword">const</span> <span class="token constant">UNITS</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;days&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;weeks&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hours&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">const</span> five <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
</span><span class="code-line">  <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> property<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token constant">UNITS</span><span class="token punctuation">.</span><span class="token method function property-access">indexOf</span><span class="token punctuation">(</span>property<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token keyword control-flow">throw</span> <span class="token known-class-name class-name">TypeError</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Invalid unit [</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>property<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] after </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>target<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">    <span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
</span><span class="code-line">      <span class="token comment">// blablabla</span>
</span><span class="code-line">    <span class="token punctuation">}</span>
</span><span class="code-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">//输入 five.minutes 将得到更加友好的错误提示：</span>
</span><span class="code-line"><span class="token comment">//Uncaught TypeError: invalid units [minutes] after 5</span>
</span></code></pre>
<h5 id="容易忽视冰山之下的设计">容易忽视冰山之下的设计<a rel="noopener noreferrer external nofollow" target="_blank" href="#容易忽视冰山之下的设计" class="anchor after" aria-hidden="true" aria-label="permalink" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" focusable="false"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a></h5>
<p>内部 DSL 的设计要点在于表现层是否流畅，而缺乏对底层领域模型的抽象封装要求。而这很可能导致 DSL 的「核」是缺乏有效设计的。在实践 DSL 时，我们在领域模型这层仍然要遵循最佳编程实践，比如本文 <code>(2).weeks.later</code> 背后的 <code>Duration</code> 等领域模型实体。</p>
<p>作者曾为内部一个历史悠久的庞大前端框架扩展了一个类似 jQuery 的流畅 API 的接口，去掉注释仅仅花费了<a rel="noopener noreferrer external nofollow" target="_blank" href="https://github.com/genify/nej/blob/master/src/util/chain/NodeList.js">不到 500 行的代码</a>，这个绝大部分归功于框架底层的深厚设计功底和一致性，而非上层的 DSL 语法糖包装。</p>
<p>此外在 DSL 设计中，语法和语义同样重要，上述诸多例子也证明了：语法的简洁不一定带来流畅性，必须要结合语义模型来设计。</p>
<blockquote>
<p>关于语法与语义：
a || b 和 a or b 语法不同，但语义相同；而 a &gt; b (Java) 和 a &gt; b (Shell) 语法相同，但语义不同</p>
</blockquote>
<p>这部分建议在外部 DSL 的设计工作中也同样重要。</p>
<h5 id="编辑器支持">编辑器支持<a rel="noopener noreferrer external nofollow" target="_blank" href="#编辑器支持" class="anchor after" aria-hidden="true" aria-label="permalink" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" focusable="false"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a></h5>
<p>有些内部 DSL 依赖排版来达到最佳表现，绝大部分语言（包括外部 DSL）的自动格式化引擎都是基于语法树解析来实现的，但内部 DSL 就没那么幸运了，由于它在实际语法层面并没有定义，所以经常会发生在编辑器使用「Format Document」后前功尽弃的情况，这类现象在基于缩进的语言中会比较少。</p>
<p>特殊的代码高亮就更难了，即使是自动补全，也需要一些额外的工作才能被支持。</p>
<h5 id="小结">小结<a rel="noopener noreferrer external nofollow" target="_blank" href="#小结" class="anchor after" aria-hidden="true" aria-label="permalink" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" focusable="false"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a></h5>
<p>常规编程解决思路下表达更多的是「How」即如何实现的细节，牵扯进的表达式、语句和数据结构等编程元素会影响到领域工作者对本源问题的理解。而 DSL 的秘诀在于它强调表达是「What」，将原本的命令式编程转化为极致的声明式表述，使得 DSL 具备强大的自解释性（self-explanatory），从而提高编程效率，甚至可以赋能给没有编程经验的用户。</p>
<p>进一步阅读以下书籍或资料可以帮助你进一步学习：</p>
<ul>
<li><a rel="noopener noreferrer external nofollow" target="_blank" href="https://book.douban.com/subject/21964984/">《领域特定语言》</a> - Martin Fowler</li>
<li><a rel="noopener noreferrer external nofollow" target="_blank" href="https://book.douban.com/subject/25741352/">《领域专用语言实战》</a> - Debasish Ghosh</li>
<li><a rel="noopener noreferrer external nofollow" target="_blank" href="http://www.ruanyifeng.com/blog/2011/06/birth_of_javascript.html">javascript 诞生记</a> - 阮一峰</li>
<li><a rel="noopener noreferrer external nofollow" target="_blank" href="https://blog.hellojs.org/declarative-programming-is-it-a-real-thing-e59fe5e893fd">Declarative programming is it a real thing?</a></li>
<li><a rel="noopener noreferrer external nofollow" target="_blank" href="https://draveness.me/dsl/">谈谈 DSL 以及 DSL 的应用（以 CocoaPods 为例）</a></li>
<li><a rel="noopener noreferrer external nofollow" target="_blank" href="https://www.cnblogs.com/weidagang2046/archive/2011/10/30/2229293.html">用流畅接口构造内部 DSL</a></li>
</ul>
<h2 id="外部-dsl--前端-dsl-实践总结">外部 DSL + 前端 DSL 实践总结<a rel="noopener noreferrer external nofollow" target="_blank" href="#外部-dsl--前端-dsl-实践总结" class="anchor after" aria-hidden="true" aria-label="permalink" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" focusable="false"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a></h2></article></div></div><div class="empty"></div></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"matter":{"title":"DSL Practice Guide","tags":["archive"],"type":"zhuanlan.zhihu.com","avatar":"https://pic1.zhimg.com/v2-1e8e1df38bdab7cc86d308de9064ee3e_is.jpg","reference":"云音乐前端技术团队专栏（郑海波）|https://zhuanlan.zhihu.com/p/107947462"},"absPath":"/home/runner/work/blog/blog/renderer/mdx/archive/dsl.mdx","type":"mdx","slug":["dsl"],"collection":"archive","url":"/archive/dsl"},"compiled":{"content":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst title = \"DSL Practice Guide\", tags = [\"archive\"], type = \"zhuanlan.zhihu.com\", avatar = \"https://pic1.zhimg.com/v2-1e8e1df38bdab7cc86d308de9064ee3e_is.jpg\", reference = \"云音乐前端技术团队专栏（郑海波）|https://zhuanlan.zhihu.com/p/107947462\";\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    img: \"img\",\n    h2: \"h2\",\n    a: \"a\",\n    svg: \"svg\",\n    path: \"path\",\n    p: \"p\",\n    ol: \"ol\",\n    li: \"li\",\n    strong: \"strong\",\n    ul: \"ul\",\n    blockquote: \"blockquote\",\n    h4: \"h4\",\n    em: \"em\",\n    pre: \"pre\",\n    code: \"code\",\n    span: \"span\",\n    h5: \"h5\"\n  }, props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.img, {\n      src: \"/images/archive/v2cb09d892ec78f48e58b918c0b8d4ca23_1200x500.jpg\",\n      alt: \"header\",\n      title: \" \",\n      width: \"1280\",\n      height: \"640\",\n      sizes: \"(max-width: 1280px) 100vw, 640px\",\n      blurDataURL: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAACCAIAAADwyuo0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIklEQVR4nGMwNTUNCQlxd3MTERZhaGlsffvu/caNm9TVNQBogwmIQ14nPQAAAABJRU5ErkJggg==\",\n      placeholder: \"blur\"\n    }), \"\\n\", _jsxs(_components.h2, {\n      id: \"前言\",\n      children: [\"前言\", _jsx(_components.a, {\n        className: \"anchor after\",\n        \"aria-hidden\": true,\n        \"aria-label\": \"permalink\",\n        tabIndex: \"-1\",\n        href: \"#前言\",\n        children: _jsx(_components.svg, {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 16 16\",\n          focusable: \"false\",\n          children: _jsx(_components.path, {\n            d: \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\",\n            fillRule: \"evenodd\"\n          })\n        })\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"近几年，前端社区中 DSL 这个词开始频繁出镜，这和环境的变化有很大关系：\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"React、Vue、Angular 等现代框架的表现层设计往往和 DSL 有较强的关联，透过这些优秀作品我们可以得到一些实践指引。\"\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"前端相关语言的转编译工具链趋于成熟，如 \", _jsx(_components.a, {\n          href: \"https://babeljs.io/\",\n          children: \"babel\"\n        }), \"，\", _jsx(_components.a, {\n          href: \"https://postcss.org/\",\n          children: \"postcss\"\n        }), \" 等工具可以帮助开发者以扩展插件的方式低成本地参与到语言构建流程中。\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"社区的解析器生成工具开始普及，如 \", _jsx(_components.a, {\n          href: \"https://github.com/zaach/jison\",\n          children: \"jison\"\n        }), \"、\", _jsx(_components.a, {\n          href: \"https://pegjs.org/\",\n          children: \"PEG.js\"\n        }), \" 等，可以帮助开发者快速实现全新的编程语言（一般是模板等外部 DSL）。\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"虽然在「术」的实践中我们开始百花齐放，但同时也产生了一些误区或迷思，比如会将 DSL 和转编译这种纯技术议题划上等号，比如会分不清内部 DSL 和库（接口）的边界等等，\", _jsx(_components.strong, {\n        children: \"DSL\"\n      }), \" 因此成了一个人人都在说但却又很陌生的词汇。\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"同时市面上的权威著作如 Martin Fowler 的《领域特定语言》虽然会偏向于「道」的解答，但里面充斥着诸如「格兰特小姐的密室控制器」以及「蹦蹦高证券公司」等等对国内前端开发者而言会水土不服的晦涩案例。实际上前端的日常工作已经和 DSL 有着千丝万缕的关系，作为开发者已经不需要通过这些生涩案例来学习 DSL。\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"由于篇幅关系，本文会分为三个部分：\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"第一部分：DSL 初识；\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"第二部分：内部 DSL；\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"第三部分：外部 DSL + 前端 DSL 实践总结\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.h2, {\n      id: \"dsl-初识\",\n      children: [\"DSL 初识\", _jsx(_components.a, {\n        className: \"anchor after\",\n        \"aria-hidden\": true,\n        \"aria-label\": \"permalink\",\n        tabIndex: \"-1\",\n        href: \"#dsl-初识\",\n        children: _jsx(_components.svg, {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 16 16\",\n          focusable: \"false\",\n          children: _jsx(_components.path, {\n            d: \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\",\n            fillRule: \"evenodd\"\n          })\n        })\n      })]\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"和很多计算机领域的概念一样，DSL 其实也算是先有实践再有定义。\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"DSL 即「Domain Specific Language」，中文一般译为「领域特定语言」，在\", _jsx(_components.a, {\n        href: \"https://book.douban.com/subject/21964984/\",\n        children: \"《领域特定语言》\"\n      }), \"这本书中它有了一个定义：\"]\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsxs(_components.p, {\n        children: [\"一种为\", _jsx(_components.strong, {\n          children: \"特定领域\"\n        }), \"设计的，具有\", _jsx(_components.strong, {\n          children: \"受限表达性\"\n        }), \"的\", _jsx(_components.strong, {\n          children: \"编程语言\"\n        })]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.h4, {\n      id: \"编程语言的发展其实是一个不断抽象的过程\",\n      children: [\"编程语言的发展其实是一个不断抽象的过程\", _jsx(_components.a, {\n        className: \"anchor after\",\n        \"aria-hidden\": true,\n        \"aria-label\": \"permalink\",\n        tabIndex: \"-1\",\n        href: \"#编程语言的发展其实是一个不断抽象的过程\",\n        children: _jsx(_components.svg, {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 16 16\",\n          focusable: \"false\",\n          children: _jsx(_components.path, {\n            d: \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\",\n            fillRule: \"evenodd\"\n          })\n        })\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"汇编语言通过助记符代替机器指令操作码，极大的增强了机器语言的可读性和可维护性。但本质上它仍是一门面向处理器和寄存器等硬件系统的低级编程语言。高级语言的出现解决了这个问题，真正脱离了对机器指令集的直接关联，以上层抽象的语句(流程控制、循环等)和数据结构等更趋近自然语言和数学公式的方式完成编码工作，大大提升了程序开发的效率。\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"但在高级语言层面，抽象带来的效率提升似乎有了天花板。无论是从 C 到 Java，抑或是各种编程范式下衍生的抽象度更高的编程语言，解决的都是通用编程问题，它们都有充分的过程抽象和数据抽象，导致大量的概念产生，进而影响了编程效率。\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"而在一些专有领域的任务处理上其实不需要那么多语言特性，DSL 就是在这种矛盾中产生的破局方案，它是为了解决特定任务的语言工具，比如文档编写有 markdown，字符串匹配有 RegExp，任务控制有 make、gradle，数据查找有 SQL，Web 样式编码有 CSS 等等。它的本质其实和我们很多软件工程问题的解决思路一样，\", _jsx(_components.strong, {\n        children: \"通过限定问题域边界，从而锁定复杂度，提高编程效率\"\n      }), \"。\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"先来个简单的例子，比如表示\", _jsx(_components.em, {\n        children: \"2 周前的时间\"\n      }), \"：\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.strong, {\n        children: \"解法一\"\n      })\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-js\",\n      children: _jsx(_components.code, {\n        className: \"language-js code-highlight\",\n        children: _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"Date\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token known-class-name class-name\",\n            children: \"Date\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"now\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"-\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"1000\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"*\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"60\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"*\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"60\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"*\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"24\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"*\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"7\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"*\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"2\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.strong, {\n        children: \"解法二\"\n      })\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-js\",\n      children: _jsx(_components.code, {\n        className: \"language-js code-highlight\",\n        children: _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token number\",\n            children: \"2\"\n          }), \" weeks ago\\n\"]\n        })\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: _jsx(_components.strong, {\n        children: \"解法三\"\n      })\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-js\",\n      children: _jsx(_components.code, {\n        className: \"language-js code-highlight\",\n        children: _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token number\",\n            children: \"2\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"weeks\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"ago\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"解法一是符合通用编程思维的解答，但即使作为程序员的我们也无法一眼看出其含义。\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"解法二和解法三其实就是 DSL 的两种不同类型——\", _jsx(_components.strong, {\n        children: \"外部 DSL\"\n      }), \"和\", _jsx(_components.strong, {\n        children: \"内部 DSL\"\n      }), \"，其直观性显然更高，但可惜无法直接运行。假如尝试在 JavaScript 环境下运行，将会获得完全不同的错误：\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [\"2 weeks ago 会得到 \", _jsx(_components.code, {\n          children: \"Uncaught SyntaxError: Unexpected identifier\"\n        }), \" 的\", _jsx(_components.strong, {\n          children: \"语法错误\"\n        }), \"。\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"(2).weeks().ago() 则会得到一个 \", _jsx(_components.code, {\n          children: \"Uncaught TypeError: 2.weeks is not a function\"\n        }), \" 的运行时\", _jsx(_components.strong, {\n          children: \"类型错误\"\n        }), \"。\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"其实从错误类型上我们就可以看到它们是有本质不同的。\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.h4, {\n      id: \"外部-dsl\",\n      children: [\"外部 DSL\", _jsx(_components.a, {\n        className: \"anchor after\",\n        \"aria-hidden\": true,\n        \"aria-label\": \"permalink\",\n        tabIndex: \"-1\",\n        href: \"#外部-dsl\",\n        children: _jsx(_components.svg, {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 16 16\",\n          focusable: \"false\",\n          children: _jsx(_components.path, {\n            d: \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\",\n            fillRule: \"evenodd\"\n          })\n        })\n      })]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"解法二称之为\", _jsx(_components.strong, {\n        children: \"外部 DSL\"\n      }), \"，它是一种\", _jsx(_components.strong, {\n        children: \"独立的编程语言\"\n      }), \"，需要从解析器开始实现自己的编译工具，实现成本较高。但它的语法的灵活性更高，更容易达到用户的表现力需求。\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"外部 DSL 的直接对应就是 GPPL，由于受限语法特性更少，一般不要求图灵完备，所以它实现难度会低于 GPPL。\"\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"GPPL 即 「General Purpose Programming Language」，又称通用编程语言，例如我们常用的 JavaScript，它们被设计用来解决通用编程问题。\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"前端常用的模板引擎如 \", _jsx(_components.a, {\n        href: \"http://mustache.github.io/\",\n        children: \"mustache\"\n      }), \" 以及 React、Vue 支持的 JSX 语法都属于外部 DSL。\\nmustache 的例子：\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-html\",\n      children: _jsxs(_components.code, {\n        className: \"language-html code-highlight\",\n        children: [_jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsxs(_components.span, {\n            className: \"token tag\",\n            children: [_jsxs(_components.span, {\n              className: \"token tag\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"\u003c\"\n              }), \"h2\"]\n            }), _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \"\u003e\"\n            })]\n          }), \"Names\", _jsxs(_components.span, {\n            className: \"token tag\",\n            children: [_jsxs(_components.span, {\n              className: \"token tag\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"\u003c/\"\n              }), \"h2\"]\n            }), _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \"\u003e\"\n            })]\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"{{#names}}\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsxs(_components.span, {\n            className: \"token tag\",\n            children: [_jsxs(_components.span, {\n              className: \"token tag\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"\u003c\"\n              }), \"strong\"]\n            }), _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \"\u003e\"\n            })]\n          }), \"{{name}}\", _jsxs(_components.span, {\n            className: \"token tag\",\n            children: [_jsxs(_components.span, {\n              className: \"token tag\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"\u003c/\"\n              }), \"strong\"]\n            }), _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \"\u003e\"\n            })]\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"{{/names}}\\n\"\n        })]\n      })\n    }), \"\\n\", _jsxs(_components.h4, {\n      id: \"内部-dsl\",\n      children: [\"内部 DSL\", _jsx(_components.a, {\n        className: \"anchor after\",\n        \"aria-hidden\": true,\n        \"aria-label\": \"permalink\",\n        tabIndex: \"-1\",\n        href: \"#内部-dsl\",\n        children: _jsx(_components.svg, {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 16 16\",\n          focusable: \"false\",\n          children: _jsx(_components.path, {\n            d: \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\",\n            fillRule: \"evenodd\"\n          })\n        })\n      })]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"解法三我们称之为 \", _jsx(_components.strong, {\n        children: \"内部 DSL（Embedded DSL or Internal DSL）\"\n      }), \"，是建立在其它宿主语言之上（GPPL）的特殊 DSL，它与宿主语言共享编译与调试工具等基础设施，学习成本更低，也更容易被集成。他在语法上与宿主语言同源，但在运行时上需要做额外的封装。\"]\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"你也可以将内部 DSL 视为针对特定任务的特殊接口封装风格，比如 jQuery 就可以认为是针对 DOM 操作的一种内部 DSL。\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"内部 DSL 的语法灵活度和语法噪音（syntactic noise）往往取决于宿主语言的选择，本篇的例子我们会围绕 JavaScript 来展开。\"\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsxs(_components.p, {\n        children: [_jsx(_components.strong, {\n          children: \"syntactic noise\"\n        }), \" is syntax within a programming language that makes the programming language more difficult to read and understand for humans.\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"最后我们来看下内部 DSL 以及外部 DSL 与一般通用语言 GPPL 的关系：\\n\"\n    }), \"\\n\", _jsx(_components.img, {\n      src: \"/images/archive/GPPLandInternalDSL,outerDSL.jpg\",\n      alt: \"Pixlr_20191217155208460.jpg\",\n      title: \" \",\n      width: \"720\",\n      height: \"328\",\n      sizes: \"(max-width: 720px) 100vw, 328px\",\n      blurDataURL: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAACCAIAAADwyuo0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAI0lEQVR4nGM4cuRodnbB3XtPX7/9wyAoJGlqbpeZU9HaNhUAvRIM29qM3IsAAAAASUVORK5CYII=\",\n      placeholder: \"blur\"\n    }), \"\\n\", _jsxs(_components.h2, {\n      id: \"内部-dsl-1\",\n      children: [\"内部 DSL\", _jsx(_components.a, {\n        className: \"anchor after\",\n        \"aria-hidden\": true,\n        \"aria-label\": \"permalink\",\n        tabIndex: \"-1\",\n        href: \"#内部-dsl-1\",\n        children: _jsx(_components.svg, {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 16 16\",\n          focusable: \"false\",\n          children: _jsx(_components.path, {\n            d: \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\",\n            fillRule: \"evenodd\"\n          })\n        })\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"结合 JavaScript 构建内部 DSL 其实有一些可套用的风格可循。\"\n    }), \"\\n\", _jsxs(_components.h4, {\n      id: \"风格-1级联方法\",\n      children: [\"风格 1：级联方法\", _jsx(_components.a, {\n        className: \"anchor after\",\n        \"aria-hidden\": true,\n        \"aria-label\": \"permalink\",\n        tabIndex: \"-1\",\n        href: \"#风格-1级联方法\",\n        children: _jsx(_components.svg, {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 16 16\",\n          focusable: \"false\",\n          children: _jsx(_components.path, {\n            d: \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\",\n            fillRule: \"evenodd\"\n          })\n        })\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"级联方法是内部 DSL 的最常用模式，我们先以原生 DOM 操作作为反面案例：\"\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-js\",\n      children: _jsxs(_components.code, {\n        className: \"language-js code-highlight\",\n        children: [_jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" userPanel \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token dom variable\",\n            children: \"document\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"querySelector\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"#user_panel\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"userPanel\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"addEventListener\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"click\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" hidePanel\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token function\",\n            children: \"slideDown\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"userPanel\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"//假设这是一个已实现的动画封装\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" followButtons \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" userPanel\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"querySelectorAll\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"button\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"followButtons\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"forEach\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token parameter\",\n            children: \"node\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=\u003e\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  node\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"innerHTML\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"follow\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"相信大家很难一眼看出做了什么，但假如我们使用远古框架 jQuery 来实现等价效果：\"\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-js\",\n      children: _jsx(_components.code, {\n        className: \"language-js code-highlight\",\n        children: _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token function\",\n            children: \"$\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"#user_panel\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"click\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"hidePanel\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"slideDown\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"find\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"button\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"html\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"follow\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"就很容易理解其中的含义：\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"找到 #user_panel 节点；\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"设置点击后隐藏它；\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"向下动效展开；\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"然后找到它下面的所有 button 节点；\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"为这些按钮填充 follow 内容。\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"级联方法等链式调用风格的核心在于\", _jsx(_components.strong, {\n        children: \"调用不再设计特定返回值，而是直接返回下一个上下文（通常是自身）\"\n      }), \"，从而实现级联调用。\"]\n    }), \"\\n\", _jsxs(_components.h4, {\n      id: \"风格-2级联管道\",\n      children: [\"风格 2：级联管道\", _jsx(_components.a, {\n        className: \"anchor after\",\n        \"aria-hidden\": true,\n        \"aria-label\": \"permalink\",\n        tabIndex: \"-1\",\n        href: \"#风格-2级联管道\",\n        children: _jsx(_components.svg, {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 16 16\",\n          focusable: \"false\",\n          children: _jsx(_components.path, {\n            d: \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\",\n            fillRule: \"evenodd\"\n          })\n        })\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"级联管道只是一种级联方法的特殊应用，代表案例就是 gulp：\"\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsxs(_components.p, {\n        children: [_jsx(_components.a, {\n          href: \"https://gulpjs.com/\",\n          children: \"gulp\"\n        }), \" 是一种类似 make 构建任务管理工具，它将文件抽象为一种叫 \", _jsx(_components.a, {\n          href: \"https://github.com/gulpjs/vinyl\",\n          children: \"Vinyl\"\n        }), \"(Virtual file format) 的类型，抽象文件使用 pipe 方法依次通过 transformer 从而完成任务。\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-js\",\n      children: _jsxs(_components.code, {\n        className: \"language-js code-highlight\",\n        children: [_jsx(_components.span, {\n          className: \"code-line\",\n          children: \"gulp\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"src\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"./scss/**/*.scss\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"pipe\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"plumber\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"pipe\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"sass\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"pipe\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"rename\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"suffix\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\".min\\\"\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"pipe\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"postcss\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"pipe\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"dest\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"./css\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"其设计哲学是衍生自 Unix 命令行中的管道，上例可以直接类比以下命令：\"\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-shell\",\n      children: _jsx(_components.code, {\n        className: \"language-shell code-highlight\",\n        children: _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token function\",\n            children: \"cat\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'./scss/**/*.scss'\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"|\"\n          }), \" plumber \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"|\"\n          }), \" sass \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"|\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"rename\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token parameter variable\",\n            children: \"--suffix\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'.min'\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"|\"\n          }), \" postcss \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"|\"\n          }), \" dest \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'./css/'\"\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"上述针对 Pipeline 的抽象也有用常规级联调用的方式来构建 DSL，比如 \", _jsx(_components.a, {\n        href: \"https://github.com/chajs/cha\",\n        children: \"chajs\"\n      }), \"：\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-js\",\n      children: _jsxs(_components.code, {\n        className: \"language-js code-highlight\",\n        children: [_jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token function\",\n            children: \"cha\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"in\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"glob\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"require\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"task-glob\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"in\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"combine\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"require\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"task-combine\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"in\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"replace\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"require\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"task-replace\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"glob\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"./scss/**/*.scss\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"plumber\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"sass\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"rename\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"suffix\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\".min\\\"\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"postcss\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"dest\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"./css\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"由于减少了多个 \", _jsx(_components.code, {\n        children: \"pipe\"\n      }), \"，代码显然是有减少的，但流畅度上并没有更大的提升。\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"其次 \", _jsx(_components.code, {\n        children: \"chajs\"\n      }), \" 的风格要求这些扩展方法都注册到实例中，这就平添了集成成本，这些集成代码也会影响到 DSL 的流畅度。相比之下，\", _jsx(_components.code, {\n        children: \"gulp\"\n      }), \" 将扩展统一抽象为一种外部 \", _jsx(_components.code, {\n        children: \"transformer\"\n      }), \"，显然设计的更加优雅。\"]\n    }), \"\\n\", _jsxs(_components.h4, {\n      id: \"风格-3级联属性\",\n      children: [\"风格 3：级联属性\", _jsx(_components.a, {\n        className: \"anchor after\",\n        \"aria-hidden\": true,\n        \"aria-label\": \"permalink\",\n        tabIndex: \"-1\",\n        href: \"#风格-3级联属性\",\n        children: _jsx(_components.svg, {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 16 16\",\n          focusable: \"false\",\n          children: _jsx(_components.path, {\n            d: \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\",\n            fillRule: \"evenodd\"\n          })\n        })\n      })]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"级联方法如文章开篇的 \", _jsx(_components.code, {\n        children: \"(2).weeks().ago()\"\n      }), \"，其实还不够简洁，存在明显的语法噪音，\", _jsx(_components.code, {\n        children: \"(2).weeks.ago\"\n      }), \"显然是个更好的方式，我们可以通过属性静态代理来实现，核心就是 \", _jsx(_components.code, {\n        children: \"Object.defineProperty()\"\n      }), \"，它可以劫持属性的 \", _jsx(_components.code, {\n        children: \"setter\"\n      }), \" 与 \", _jsx(_components.code, {\n        children: \"getter\"\n      }), \"：\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-js\",\n      children: _jsxs(_components.code, {\n        className: \"language-js code-highlight\",\n        children: [_jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" hours \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"1000\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"*\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"60\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"*\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"60\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" days \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" hours \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"*\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"24\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" weeks \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" days \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"*\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"7\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token constant\",\n            children: \"UNIT_TO_NUM\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" hours\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" days\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" weeks \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"class\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"Duration\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"constructor\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token parameter\",\n            children: [\"num\", _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \",\"\n            }), \" unit\"]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"this\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"number\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" num\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"this\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"unit\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" unit\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"toNumber\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token constant\",\n            children: \"UNIT_TO_NUM\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"this\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"unit\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"*\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"this\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"number\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"get\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"ago\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"Date\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token known-class-name class-name\",\n            children: \"Date\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"now\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"-\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"this\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"toNumber\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"get\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"later\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"Date\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token known-class-name class-name\",\n            children: \"Date\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"now\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"+\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"this\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"toNumber\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token known-class-name class-name\",\n            children: \"Object\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"keys\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token constant\",\n            children: \"UNIT_TO_NUM\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"forEach\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token parameter\",\n            children: \"unit\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=\u003e\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token known-class-name class-name\",\n            children: \"Object\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"defineProperty\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"Number\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"prototype\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" unit\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"get\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"      \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"Duration\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"this\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" unit\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"//console.log( (2).weeks.ago )\"\n          }), \"\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"可以看到级联属性可以比级联方法拥有更简洁的表述，但同时也丢失了参数层面的灵活性。\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"在 DSL 风格中，无论是级联方法、级联管道还是级联属性，本质都是链式调用风格，链式调用的核心是上下文传递，所以\", _jsx(_components.strong, {\n        children: \"每一次调用的返回实体是否符合用户的心智\"\n      }), \"是 DSL 设计是否成功的重要依据。\"]\n    }), \"\\n\", _jsxs(_components.h4, {\n      id: \"风格-4嵌套函数\",\n      children: [\"风格 4：嵌套函数\", _jsx(_components.a, {\n        className: \"anchor after\",\n        \"aria-hidden\": true,\n        \"aria-label\": \"permalink\",\n        tabIndex: \"-1\",\n        href: \"#风格-4嵌套函数\",\n        children: _jsx(_components.svg, {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 16 16\",\n          focusable: \"false\",\n          children: _jsx(_components.path, {\n            d: \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\",\n            fillRule: \"evenodd\"\n          })\n        })\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"开发中也存在一些层级抽象的场景，比如 DOM 树的生成，纯粹命令式使用 DOM API 来构建的写法略显晦涩，很难一眼看出最终的 HTML 结构，那如何构建内部 DSL 来流畅解决这种层级抽象呢？\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"有人就尝试用类似链式调用的方式去实现，比如 \", _jsx(_components.a, {\n        href: \"https://github.com/hoho/concat.js\",\n        children: \"concat.js\"\n      }), \"：\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-js\",\n      children: _jsxs(_components.code, {\n        className: \"language-js code-highlight\",\n        children: [_jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token function\",\n            children: \"builder\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token dom variable\",\n            children: \"document\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"body\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"div\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"#container\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"h1\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"text\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"This is hyperscript\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"end\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"ul\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" title \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"li\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"a\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"href\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"abc.com\\\"\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"text\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"One list item\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"end\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"end\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"li\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"text\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"Another list item\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"end\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"end\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"end\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"这似乎比命令式的写法好了不少，但构建这种 DSL 存在不少问题：\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"因为链式调用的关键是上下文传递，在层级抽象中需额外的 end() 出栈动作实现上下文切换。\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"可读性强依赖于手动缩进，而编辑器的自动缩进往往会打破这种和谐。\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"所以一般层级结构抽象很少使用链式调用风格来构建 DSL，而会更多的使用基本的\", _jsx(_components.strong, {\n        children: \"嵌套函数\"\n      }), \"来实现。\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"我们以另一个骨灰开源项目 \", _jsx(_components.a, {\n        href: \"https://github.com/insin/DOMBuilder\",\n        children: \"DOMBuilder\"\n      }), \" 为例：\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-js\",\n      children: _jsxs(_components.code, {\n        className: \"language-js code-highlight\",\n        children: [_jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"with\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"DOMBuilder\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"dom\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"  \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"//这里先抛开 with 本身的使用问题\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" node \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"div\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'#container'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"      \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"h1\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'This is hyperscript'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"      \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"ul\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"title\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"        \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"li\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"            \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"a\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"herf\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'abc.com'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'One list item'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"        \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"        \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"li\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'Another list item'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"可以看到层级结构抽象使用嵌套函数来实现会更流畅。\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"如果使用 CoffeeScript 来描述，语法噪音可以降到更低，可以接近 pug 这种外部 DSL 的语法：\"\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-pug\",\n      children: _jsxs(_components.code, {\n        className: \"language-pug code-highlight\",\n        children: [_jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token tag\",\n            children: \"div\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token plain-text\",\n            children: \"'#container',\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token tag\",\n            children: \"h1\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token plain-text\",\n            children: \"'This is hyperscript'\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token tag\",\n            children: \"ul\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token plain-text\",\n            children: \"{title},\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token tag\",\n            children: \"li\"\n          }), \"(\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"      \", _jsx(_components.span, {\n            className: \"token tag\",\n            children: \"a\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token plain-text\",\n            children: \"href:'abc.com', 'One list item'\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"    )\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token tag\",\n            children: \"li\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token plain-text\",\n            children: \"'Another list item'\"\n          }), \"\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"嵌套函数本质上是将在链式调用中需要处理的上下文切换隐含在了函数嵌套操作中，所以它在层级抽象场景是非常适用的。\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"另外，嵌套函数在 DSL 的应用类似解析树，因为其符合语法树生成思路，往往可直接映射转换为对应外部 DSL，比如 JSX：\"\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-jsx\",\n      children: _jsxs(_components.code, {\n        className: \"language-JSX code-highlight\",\n        children: [_jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsxs(_components.span, {\n            className: \"token tag\",\n            children: [_jsxs(_components.span, {\n              className: \"token tag\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"\u003c\"\n              }), \"div\"]\n            }), \" \", _jsx(_components.span, {\n              className: \"token attr-name\",\n              children: \"id\"\n            }), _jsxs(_components.span, {\n              className: \"token attr-value\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation attr-equals\",\n                children: \"=\"\n              }), _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"'\"\n              }), \"container\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"'\"\n              })]\n            }), _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \"\u003e\"\n            })]\n          }), _jsx(_components.span, {\n            className: \"token plain-text\",\n            children: \"\\n\"\n          })]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token plain-text\",\n            children: \"  \"\n          }), _jsxs(_components.span, {\n            className: \"token tag\",\n            children: [_jsxs(_components.span, {\n              className: \"token tag\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"\u003c\"\n              }), \"h1\"]\n            }), \" \", _jsx(_components.span, {\n              className: \"token attr-name\",\n              children: \"id\"\n            }), _jsxs(_components.span, {\n              className: \"token attr-value\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation attr-equals\",\n                children: \"=\"\n              }), _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"'\"\n              }), \"heading\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"'\"\n              })]\n            }), _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \"\u003e\"\n            })]\n          }), _jsx(_components.span, {\n            className: \"token plain-text\",\n            children: \" This is hyperscript \"\n          }), _jsxs(_components.span, {\n            className: \"token tag\",\n            children: [_jsxs(_components.span, {\n              className: \"token tag\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"\u003c/\"\n              }), \"h1\"]\n            }), _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \"\u003e\"\n            })]\n          }), _jsx(_components.span, {\n            className: \"token plain-text\",\n            children: \"\\n\"\n          })]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token plain-text\",\n            children: \"  \"\n          }), _jsxs(_components.span, {\n            className: \"token tag\",\n            children: [_jsxs(_components.span, {\n              className: \"token tag\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"\u003c\"\n              }), \"ul\"]\n            }), \" \", _jsx(_components.span, {\n              className: \"token attr-name\",\n              children: \"title\"\n            }), _jsxs(_components.span, {\n              className: \"token script language-javascript\",\n              children: [_jsx(_components.span, {\n                className: \"token script-punctuation punctuation\",\n                children: \"=\"\n              }), _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"title\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \"\u003e\"\n            })]\n          }), _jsx(_components.span, {\n            className: \"token plain-text\",\n            children: \"\\n\"\n          })]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token plain-text\",\n            children: \"    \"\n          }), _jsxs(_components.span, {\n            className: \"token tag\",\n            children: [_jsxs(_components.span, {\n              className: \"token tag\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"\u003c\"\n              }), \"li\"]\n            }), _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \"\u003e\"\n            })]\n          }), _jsxs(_components.span, {\n            className: \"token tag\",\n            children: [_jsxs(_components.span, {\n              className: \"token tag\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"\u003c\"\n              }), \"a\"]\n            }), \" \", _jsx(_components.span, {\n              className: \"token attr-name\",\n              children: \"href\"\n            }), _jsxs(_components.span, {\n              className: \"token script language-javascript\",\n              children: [_jsx(_components.span, {\n                className: \"token script-punctuation punctuation\",\n                children: \"=\"\n              }), _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"{\"\n              }), \"href\", _jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"}\"\n              })]\n            }), \" \", _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \"\u003e\"\n            })]\n          }), _jsx(_components.span, {\n            className: \"token plain-text\",\n            children: \" One list item \"\n          }), _jsxs(_components.span, {\n            className: \"token tag\",\n            children: [_jsxs(_components.span, {\n              className: \"token tag\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"\u003c/\"\n              }), \"a\"]\n            }), _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \"\u003e\"\n            })]\n          }), _jsxs(_components.span, {\n            className: \"token tag\",\n            children: [_jsxs(_components.span, {\n              className: \"token tag\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"\u003c/\"\n              }), \"li\"]\n            }), _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \"\u003e\"\n            })]\n          }), _jsx(_components.span, {\n            className: \"token plain-text\",\n            children: \"\\n\"\n          })]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token plain-text\",\n            children: \"    \"\n          }), _jsxs(_components.span, {\n            className: \"token tag\",\n            children: [_jsxs(_components.span, {\n              className: \"token tag\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"\u003c\"\n              }), \"li\"]\n            }), _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \"\u003e\"\n            })]\n          }), _jsx(_components.span, {\n            className: \"token plain-text\",\n            children: \" Another list item \"\n          }), _jsxs(_components.span, {\n            className: \"token tag\",\n            children: [_jsxs(_components.span, {\n              className: \"token tag\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"\u003c/\"\n              }), \"li\"]\n            }), _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \"\u003e\"\n            })]\n          }), _jsx(_components.span, {\n            className: \"token plain-text\",\n            children: \"\\n\"\n          })]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token plain-text\",\n            children: \"  \"\n          }), _jsxs(_components.span, {\n            className: \"token tag\",\n            children: [_jsxs(_components.span, {\n              className: \"token tag\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"\u003c/\"\n              }), \"ul\"]\n            }), _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \"\u003e\"\n            })]\n          }), _jsx(_components.span, {\n            className: \"token plain-text\",\n            children: \"\\n\"\n          })]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token plain-text\"\n          }), _jsxs(_components.span, {\n            className: \"token tag\",\n            children: [_jsxs(_components.span, {\n              className: \"token tag\",\n              children: [_jsx(_components.span, {\n                className: \"token punctuation\",\n                children: \"\u003c/\"\n              }), \"div\"]\n            }), _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \"\u003e\"\n            })]\n          }), \"\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"嵌套函数并不是万金油，它天然不适合流程、时间等顺序敏感的场景。\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"例如，如果将风格 2 的级联管道修改为嵌套函数：\\n\"\n    }), \"\\n\", _jsx(_components.img, {\n      src: \"/images/archive/nestedFuctionsInProcessAbsctractionExample.jpg\",\n      alt: \"嵌套函数在流程抽象的应用范例\",\n      title: \"嵌套函数在流程抽象的应用范例\",\n      width: \"480\",\n      height: \"406\",\n      sizes: \"(max-width: 480px) 100vw, 406px\",\n      blurDataURL: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAIAAAA7ljmRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAMElEQVR4nGP4+u3/j7//wyLSjUydGRpaJk+evtTSxkNCWp1BQFiBT0iOnUtaU8cKAGlWDVfAtvkxAAAAAElFTkSuQmCC\",\n      placeholder: \"blur\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"执行逻辑与阅读顺序显然不一致，并且会加重书写负担(同时要关心开闭逻辑)，极大影响读写流畅度。\"\n    }), \"\\n\", _jsxs(_components.h4, {\n      id: \"风格-5对象字面量\",\n      children: [\"风格 5：对象字面量\", _jsx(_components.a, {\n        className: \"anchor after\",\n        \"aria-hidden\": true,\n        \"aria-label\": \"permalink\",\n        tabIndex: \"-1\",\n        href: \"#风格-5对象字面量\",\n        children: _jsx(_components.svg, {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 16 16\",\n          focusable: \"false\",\n          children: _jsx(_components.path, {\n            d: \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\",\n            fillRule: \"evenodd\"\n          })\n        })\n      })]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"业界很多 DSL 都类似于配置文件，例如 \", _jsx(_components.a, {\n        href: \"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON\",\n        children: \"JSON\"\n      }), \"、\", _jsx(_components.a, {\n        href: \"https://yaml.org/\",\n        children: \"YAML\"\n      }), \" 等外部 DSL，它们在嵌套数据展现中有很强的表达力。\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"而 JavaScript 也有一个适合在此场景构建 DSL 的特性，那就是字面量对象，实际上，JSON（全称 JavaScript Object Notation）正是衍生自它的这个特性，成为了一种标准数据交换格式。\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"例如在项目 \", _jsx(_components.a, {\n        href: \"https://github.com/leeluolee/puer\",\n        children: \"puer\"\n      }), \" 中，路由配置文件选择了 JS 的对象字面量而不是 JSON：\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-js\",\n      children: _jsxs(_components.code, {\n        className: \"language-js code-highlight\",\n        children: [_jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"module\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"exports\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token string-property property\",\n            children: \"'GET /homepage'\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'./view/static.html'\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token string-property property\",\n            children: \"'GET /blog'\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"        \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"title\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'Hello'\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token string-property property\",\n            children: \"'GET /user/:id'\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token parameter\",\n            children: [\"req\", _jsx(_components.span, {\n              className: \"token punctuation\",\n              children: \",\"\n            }), \" res\"]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=\u003e\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"        res\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"render\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'user.vm'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"因为 JSON 有一个天然缺陷就是要求可序列化，这极大的限制了它的表达力（不过也使它成为了最流行的跨语言数据交换格式），比如上例最后一条还引入了函数，虽然从 DSL 角度来说变得“不纯粹”了，但功能性却上了一个台阶。这也是为什么一些构建任务相关的 DSL（make、rake、cake、gradle 等）几乎全部都是内部 DSL 的原因。\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"除此之外，因为对象 key 值的存在，对象字面量也能提高参数可读性，比如：\"\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-js\",\n      children: _jsxs(_components.code, {\n        className: \"language-js code-highlight\",\n        children: [_jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token function\",\n            children: \"div\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"id\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'container'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"title\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'This is a tip'\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// CoffeeScript Version\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"div id\", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'container'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"title\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'This is a tip'\"\n          }), \"\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"显然比用词更少的下例可读性更佳：\"\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-js\",\n      children: _jsx(_components.code, {\n        className: \"language-js code-highlight\",\n        children: _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token function\",\n            children: \"div\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"container\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"This is a tip\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        })\n      })\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"构造 DSL 并非越简洁越好，提高流畅度才是关键。\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"对象字面量的结构性较强，一般只用来做配置等数据抽象的场景，不适合用在过程抽象的场景。\"\n    }), \"\\n\", _jsxs(_components.h4, {\n      id: \"风格-6动态代理\",\n      children: [\"风格 6：动态代理\", _jsx(_components.a, {\n        className: \"anchor after\",\n        \"aria-hidden\": true,\n        \"aria-label\": \"permalink\",\n        tabIndex: \"-1\",\n        href: \"#风格-6动态代理\",\n        children: _jsx(_components.svg, {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 16 16\",\n          focusable: \"false\",\n          children: _jsx(_components.path, {\n            d: \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\",\n            fillRule: \"evenodd\"\n          })\n        })\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"之前所列举内部 DSL 的构造方式有一个典型缺陷就是它们都是静态定义的属性或方法，没有动态性。\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"如上节 \", _jsx(_components.strong, {\n        children: \"[风格 4: 嵌套函数]\"\n      }), \" 中的提到 concat.js，它的所有类似 div、p 等方法都是\", _jsx(_components.a, {\n        href: \"https://github.com/hoho/concat.js/blob/master/concat.js#L22\",\n        children: \"静态具名定义的\"\n      }), \"。而实际上因为 \", _jsx(_components.a, {\n        href: \"https://developer.mozilla.org/zh-CN/docs/Web/Web_Components/Using_custom_elements\",\n        children: \"custom elements\"\n      }), \" 特性的存在，这种静态穷举的方式显然是有坑的，更别说 html 标准本身也在不断增加新标签。\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"而在外部 DSL，这个问题是不存在的。那么内部 DSL 要怎么实现呢？若内部 DSL 要实现这种特性，就强依赖宿主语言的元编程能力了。 Ruby 作为典型宿主语言经常会用来证明其强大元编程能力的特性就是 \", _jsx(_components.a, {\n        href: \"https://www.leighhalliday.com/ruby-metaprogramming-method-missing\",\n        children: \"method_missing\"\n      }), \"，这个方法可以动态接收所有未定义的方法，最直接功能就是动态命名方法（或元方法），这样就可以解决上面提到的内部 DSL 都是具名静态定义的问题。\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"值得庆幸的是在 JavaScript 中也有了一个更强大的语言特性，就是 \", _jsx(_components.a, {\n        href: \"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy\",\n        children: \"Proxy\"\n      }), \"，它可以代理属性获取，从而解决上文的穷举问题。\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-js\",\n      children: _jsxs(_components.code, {\n        className: \"language-js code-highlight\",\n        children: [_jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// 用于演示，非完整代码\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"function\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"tag\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token parameter\",\n            children: \"tagName\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token literal-property property\",\n            children: \"tag\"\n          }), _jsx(_components.span, {\n            className: \"token operator\",\n            children: \":\"\n          }), \" tagName \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" builder \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"Proxy\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"tag\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"get\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"target\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" property\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"return\"\n          }), \" tag\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"bind\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token keyword null nil\",\n            children: \"null\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" property\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"builder\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"h1\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// {tag: 'h1'}\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"builder\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"tag_not_defined\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// {tag: 'tag_not_defined'}\"\n          }), \"\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Proxy 使得 JavaScript 具备了极强的元编程能力，它除了可以轻松\", _jsx(_components.a, {\n        href: \"https://www.cnblogs.com/htoooth/p/11367829.html\",\n        children: \"模拟出 Ruby 中的 method_missing 特性\"\n      }), \"外，也可以有很多\", _jsx(_components.a, {\n        href: \"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy#%E4%B8%80%E4%B8%AA%E5%AE%8C%E6%95%B4%E7%9A%84_traps_%E5%88%97%E8%A1%A8%E7%A4%BA%E4%BE%8B\",\n        children: \"其它动态代理能力\"\n      }), \"，这些都是实现内部 DSL 的重要工具。\"]\n    }), \"\\n\", _jsxs(_components.h4, {\n      id: \"风格-7lambda-表达式\",\n      children: [\"风格 7：Lambda 表达式\", _jsx(_components.a, {\n        className: \"anchor after\",\n        \"aria-hidden\": true,\n        \"aria-label\": \"permalink\",\n        tabIndex: \"-1\",\n        href: \"#风格-7lambda-表达式\",\n        children: _jsx(_components.svg, {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 16 16\",\n          focusable: \"false\",\n          children: _jsx(_components.path, {\n            d: \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\",\n            fillRule: \"evenodd\"\n          })\n        })\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"市面上有大量的查询库使用链式风格，它们非常接近 SQL 本身的写法，比如：\"\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-js\",\n      children: _jsxs(_components.code, {\n        className: \"language-js code-highlight\",\n        children: [_jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" users \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"User\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"select\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'name'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"where\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'id==1'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"where\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'age \u003e 1'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"sortBy\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'create_time'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"为了将 id==1 等表达式转化为可运行的过滤条件，我们不得不去实现完整的表达式解析器，以最终编译得到等价函数。\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"这样做的实现成本非常高，而使用 lambda 表达式可以更低成本地解决这种需求\"\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-js\",\n      children: _jsxs(_components.code, {\n        className: \"language-js code-highlight\",\n        children: [_jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" users \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token maybe-class-name\",\n            children: \"User\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"select\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'name'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"where\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token parameter\",\n            children: \"user\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=\u003e\"\n          }), \" user\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"id\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"1\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"where\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token parameter\",\n            children: \"user\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token arrow operator\",\n            children: \"=\u003e\"\n          }), \" user\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"age\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"\u003e\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"20\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"sortBy\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'create_time'\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"这种应用案例其实早就存在了，比如基于 C#的\", _jsx(_components.a, {\n        href: \"https://docs.microsoft.com/en-us/dotnet/csharp/linq/\",\n        children: \"LINQ(Language-Integrated Query)\"\n      }), \"，这也是最常活跃在内部 DSL 技术圈的典型案例。\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-csharp\",\n      children: _jsxs(_components.code, {\n        className: \"language-csharp code-highlight\",\n        children: [_jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token class-name\",\n            children: _jsx(_components.span, {\n              className: \"token keyword\",\n              children: \"var\"\n            })\n          }), \" result \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" products\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"Where\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"p \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\u003e\"\n          }), \" p\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"UnitPrice \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"\u003e=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"20\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"GroupBy\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"p \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\u003e\"\n          }), \" p\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"CategoryName\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"OrderByDescending\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"g \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\u003e\"\n          }), \" g\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"Count\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"Select\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"g \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\u003e\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" Name \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" g\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), \"Key\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" Count \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" g\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token function\",\n            children: \"Count\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Lambda 表达式本质上是一种直观易读且\", _jsx(_components.strong, {\n        children: \"延迟执行\"\n      }), \"的逻辑表达能力，从而避免额外的解析工作，不过它强依托宿主的语言特性支持(匿名函数 + 箭头表示)，并且也会引入一定的语法噪音。\"]\n    }), \"\\n\", _jsxs(_components.h4, {\n      id: \"风格-8自然语言抽象\",\n      children: [\"风格 8：自然语言抽象\", _jsx(_components.a, {\n        className: \"anchor after\",\n        \"aria-hidden\": true,\n        \"aria-label\": \"permalink\",\n        tabIndex: \"-1\",\n        href: \"#风格-8自然语言抽象\",\n        children: _jsx(_components.svg, {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 16 16\",\n          focusable: \"false\",\n          children: _jsx(_components.path, {\n            d: \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\",\n            fillRule: \"evenodd\"\n          })\n        })\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"自然语言抽象即以更贴近自然语言的方式去设计 DSL 的语法，它行得通的基本逻辑是领域专家基本都是和你我一样的自然人，更容易接受自然语言的语法。\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"自然语言抽象的本质是一些语法糖，和一般 GPPL 的语法糖不一样， DSL 的语法糖并不一定是最简洁的，反而会加入一些「冗余」的非功能性语法词汇。\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"通过自然语言抽象，内部 DSL 的优势在单元测试场景中被发挥的淋漓尽致，比如如果我们裸用类似 \", _jsx(_components.a, {\n        href: \"http://nodejs.cn/api/assert.html#assert_assert_value_message\",\n        children: \"assert\"\n      }), \" 的断言方法，单元测试用例可能是这样的：\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-js\",\n      children: _jsxs(_components.code, {\n        className: \"language-js code-highlight\",\n        children: [_jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"var\"\n          }), \" foo \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"43\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token function\",\n            children: \"assert\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"typeof\"\n          }), \" foo \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"number\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"expect foo to be a number\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token function\",\n            children: \"assert\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  tea\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"flavors\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"\u0026\u0026\"\n          }), \" tea\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"flavors\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"length\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token number\",\n            children: \"3\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"c should have property flavors with length of 3\\\"\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"有几个显著待优化的问题：\"\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"命令式的断言语句阅读不直观；\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"为了 report 的可读性，需要传入额外的提示语（如 expect foo to be a number）。\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"如果这个 case 基于 chai 来书写的话，可读性会立马上一个台阶：\"\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-js\",\n      children: _jsxs(_components.code, {\n        className: \"language-js code-highlight\",\n        children: [_jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"var\"\n          }), \" foo \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"43\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// AssertionError: '43' should be a 'number'.\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"foo\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"should\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"be\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"a\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"number\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"tea\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"should\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"have\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"property\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"flavors\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token property-access\",\n            children: \"with\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"lengthOf\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token number\",\n            children: \"3\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"可以发现测试用例变得更加易读易写了，而且当断言失败，也会自动根据链式调用产生的状态，自动拼装出更友好的错误信息。\"\n    }), \"\\n\", _jsxs(_components.h4, {\n      id: \"总结\",\n      children: [\"总结\", _jsx(_components.a, {\n        className: \"anchor after\",\n        \"aria-hidden\": true,\n        \"aria-label\": \"permalink\",\n        tabIndex: \"-1\",\n        href: \"#总结\",\n        children: _jsx(_components.svg, {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 16 16\",\n          focusable: \"false\",\n          children: _jsx(_components.path, {\n            d: \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\",\n            fillRule: \"evenodd\"\n          })\n        })\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"本文并未囊括所有内部 DSL 实现风格(比如也有些基于 Decorator 装饰器的玩法)，且所列风格都不是银弹，都有其适用场景，它们之间存在互补效应。\\n\"\n    }), \"\\n\", _jsx(_components.img, {\n      src: \"/images/archive/internalDSLCompare.jpg\",\n      alt: \"所列举的内部DSL构建风格对比简表\",\n      width: \"720\",\n      height: \"348\",\n      sizes: \"(max-width: 720px) 100vw, 348px\",\n      blurDataURL: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAACCAIAAADwyuo0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAI0lEQVR4nGNwc3PT1taZPXt2XV0dg7a2TmJi4uzZs3fv3g0AcW8KR9/Jjq0AAAAASUVORK5CYII=\",\n      placeholder: \"blur\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"通过上面的一些惯用风格的介绍，我们建立了对前端内部 DSL 的一些了解，以下再针对「Why」的问题做下深入讨论：\"\n    }), \"\\n\", _jsxs(_components.h5, {\n      id: \"js-why\",\n      children: [\"JS, why?\", _jsx(_components.a, {\n        className: \"anchor after\",\n        \"aria-hidden\": true,\n        \"aria-label\": \"permalink\",\n        tabIndex: \"-1\",\n        href: \"#js-why\",\n        children: _jsx(_components.svg, {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 16 16\",\n          focusable: \"false\",\n          children: _jsx(_components.path, {\n            d: \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\",\n            fillRule: \"evenodd\"\n          })\n        })\n      })]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"从风格案例可以看到，\", _jsx(_components.strong, {\n        children: \"宿主语言直接决定了内部 DSL 的「语法」优化的上限\"\n      }), \"。正如 ROR 之于 Ruby、Gradle 之于 Groovy，典型的前期选择大于后天努力。而前端开发最趁手的语言 JavaScript 其实在构建内部 DSL 时具备了很大的优势：\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"借鉴 Java 语言的数据类型和内存管理，抽象度高。\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"基于对象，且拥有方便的对象字面量表示等，数据表达力一流。\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"函数为第一等公民（first class），可以有一些泛 FP 的应用。\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"使用基于原型（prototype）的继承机制，并且可扩展原始类型如 Number。\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"Proxy、Reflect 等新特性加持下具备了极强的元编程能力。\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"但要注意的是，JavaScript 存在的天然缺陷就是它那衍生自 C 的语法，导致噪音较强，使用一些变种语言（如 CoffeeScript）可以扭转一些这种劣势。\"\n    }), \"\\n\", _jsxs(_components.h5, {\n      id: \"库接口还是内部-dsl\",\n      children: [\"库（接口）还是内部 DSL\", _jsx(_components.a, {\n        className: \"anchor after\",\n        \"aria-hidden\": true,\n        \"aria-label\": \"permalink\",\n        tabIndex: \"-1\",\n        href: \"#库接口还是内部-dsl\",\n        children: _jsx(_components.svg, {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 16 16\",\n          focusable: \"false\",\n          children: _jsx(_components.path, {\n            d: \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\",\n            fillRule: \"evenodd\"\n          })\n        })\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"外部 DSL 的边界问题往往是 DSL 与 GPPL 的区别，这个在社区中的争议并不算很大。而关于内部 DSL 的讨论，特别是与库（接口）的差异问题就一直都没消停过，确实存在模糊的部分。\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"实际上 DSL 也有个别名叫\", _jsx(_components.strong, {\n        children: \"流畅接口\"\n      }), \"，所以它本身也属于接口封装或库封装的一种模式，目标是极限表达力。但它相较于传统接口封装，有几个显著设计差异点：\"]\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"语言性。\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"不受传统编程最佳实践的束缚：如命令-查询分离、迪米特法则等。\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"比如在内部 DSL 中，得到代码如 \", _jsx(_components.code, {\n        children: \"foo.should.be.a.number\"\n      }), \" 就像是一个在既定语法下有关联的整句，而不是命令式代码的集合。而 jQuery 中 html 既是查询方法（\", _jsx(_components.code, {\n        children: \".html()\"\n      }), \"）也是命令方法（\", _jsx(_components.code, {\n        children: \".html('content to set')\"\n      }), \"），这显然背离了命令查询分离的原则。它们设计的首要目标是「极限流畅的表现力」，而非职责清晰、降低耦合度等传统的封装抽象准则。\"]\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsxs(_components.p, {\n        children: [\"如松本行弘先生在\", _jsx(_components.a, {\n          href: \"https://book.douban.com/subject/24536403/\",\n          children: \"《代码的未来》\"\n        }), \"中引述的观点，也算是该问题的一个解答：\", _jsx(_components.strong, {\n          children: \"库设计就是语言设计\"\n        })]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.strong, {\n        children: \"编程语言只确定了基本语法框架和少量词汇，库设计应该将其与充当词汇池的类、方法、属性甚至变量相结合，并将它们按语义有机结合\"\n      }), \"，最终真正实现「在限定任务下，编程工作者只需要关注 What，而无需关注 How」的设计目标。这也就是 \", _jsx(_components.code, {\n        children: \"(2).weeks.ago\"\n      }), \" 的魔力所在，编程（语言）的发展方向就应该如此，才能达到更高的抽象维度。\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"所以与其尝试去为内部 DSL 划分一个明确的边界，不如根据它的要求去改善你的接口设计。这里引申另一个更激进的观点：\"\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: _jsx(_components.strong, {\n          children: \"Programming is a process of designing DSL for your own application.\"\n        })\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.h4, {\n      id: \"内部-dsl-实践的一些坑\",\n      children: [\"内部 DSL 实践的一些坑\", _jsx(_components.a, {\n        className: \"anchor after\",\n        \"aria-hidden\": true,\n        \"aria-label\": \"permalink\",\n        tabIndex: \"-1\",\n        href: \"#内部-dsl-实践的一些坑\",\n        children: _jsx(_components.svg, {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 16 16\",\n          focusable: \"false\",\n          children: _jsx(_components.path, {\n            d: \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\",\n            fillRule: \"evenodd\"\n          })\n        })\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"除了由于依赖于宿主语言，导致功能性缺失和额外的语法噪音之外，内部 DSL 也存在其它不可忽视的问题。\"\n    }), \"\\n\", _jsxs(_components.h5, {\n      id: \"不友好的异常\",\n      children: [\"不友好的异常\", _jsx(_components.a, {\n        className: \"anchor after\",\n        \"aria-hidden\": true,\n        \"aria-label\": \"permalink\",\n        tabIndex: \"-1\",\n        href: \"#不友好的异常\",\n        children: _jsx(_components.svg, {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 16 16\",\n          focusable: \"false\",\n          children: _jsx(_components.path, {\n            d: \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\",\n            fillRule: \"evenodd\"\n          })\n        })\n      })]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"在 \", _jsx(_components.strong, {\n        children: \"[风格 3: 级联属性]\"\n      }), \" 的案例中，其实我们没有定义 \", _jsx(_components.code, {\n        children: \"minutes\"\n      }), \" 这个单位, 如果错误的使用\", _jsx(_components.code, {\n        children: \"(5).minutes.later\"\n      }), \"，将得到以下错误提示：\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-shell\",\n      children: _jsx(_components.code, {\n        className: \"language-shell code-highlight\",\n        children: _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"Uncaught TypeError: Cannot \", _jsx(_components.span, {\n            className: \"token builtin class-name\",\n            children: \"read\"\n          }), \" property \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"'later'\"\n          }), \" of undefined\\n\"]\n        })\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"而不是我们预期的类似报错信息：\"\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-shell\",\n      children: _jsx(_components.code, {\n        className: \"language-shell code-highlight\",\n        children: _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"Uncaught SyntaxError: Unexpected unit minutes\\n\"\n        })\n      })\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"这是由于异常处理机制也遵循宿主语言，在库封装层面做 DSL 抽象依然无法逃脱这个限制，这也是外部 DSL 的优势所在，不过基于 \", _jsx(_components.strong, {\n        children: \"[风格 6：动态代理]\"\n      }), \" 提到的 Proxy，我们仍能做一些微不足道的小优化：\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-js\",\n      children: _jsxs(_components.code, {\n        className: \"language-js code-highlight\",\n        children: [_jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token constant\",\n            children: \"UNITS\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"[\"\n          }), _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"days\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"weeks\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token string\",\n            children: \"\\\"hours\\\"\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"]\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"const\"\n          }), \" five \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"=\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"Proxy\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token keyword\",\n            children: \"new\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token class-name\",\n            children: \"Number\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token number\",\n            children: \"5\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token function\",\n            children: \"get\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"target\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \" property\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"if\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsx(_components.span, {\n            className: \"token constant\",\n            children: \"UNITS\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \".\"\n          }), _jsx(_components.span, {\n            className: \"token method function property-access\",\n            children: \"indexOf\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), \"property\", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"===\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token operator\",\n            children: \"-\"\n          }), _jsx(_components.span, {\n            className: \"token number\",\n            children: \"1\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"      \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"throw\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token known-class-name class-name\",\n            children: \"TypeError\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"(\"\n          }), _jsxs(_components.span, {\n            className: \"token template-string\",\n            children: [_jsx(_components.span, {\n              className: \"token template-punctuation string\",\n              children: \"`\"\n            }), _jsx(_components.span, {\n              className: \"token string\",\n              children: \"Invalid unit [\"\n            }), _jsxs(_components.span, {\n              className: \"token interpolation\",\n              children: [_jsx(_components.span, {\n                className: \"token interpolation-punctuation punctuation\",\n                children: \"${\"\n              }), \"property\", _jsx(_components.span, {\n                className: \"token interpolation-punctuation punctuation\",\n                children: \"}\"\n              })]\n            }), _jsx(_components.span, {\n              className: \"token string\",\n              children: \"] after \"\n            }), _jsxs(_components.span, {\n              className: \"token interpolation\",\n              children: [_jsx(_components.span, {\n                className: \"token interpolation-punctuation punctuation\",\n                children: \"${\"\n              }), \"target\", _jsx(_components.span, {\n                className: \"token interpolation-punctuation punctuation\",\n                children: \"}\"\n              })]\n            }), _jsx(_components.span, {\n              className: \"token template-punctuation string\",\n              children: \"`\"\n            })]\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token keyword control-flow\",\n            children: \"else\"\n          }), \" \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"      \", _jsx(_components.span, {\n            className: \"token comment\",\n            children: \"// blablabla\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"    \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [\"  \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \",\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \")\"\n          }), _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \";\"\n          }), \"\\n\"]\n        }), _jsx(_components.span, {\n          className: \"code-line\",\n          children: \"\\n\"\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"//输入 five.minutes 将得到更加友好的错误提示：\"\n          }), \"\\n\"]\n        }), _jsxs(_components.span, {\n          className: \"code-line\",\n          children: [_jsx(_components.span, {\n            className: \"token comment\",\n            children: \"//Uncaught TypeError: invalid units [minutes] after 5\"\n          }), \"\\n\"]\n        })]\n      })\n    }), \"\\n\", _jsxs(_components.h5, {\n      id: \"容易忽视冰山之下的设计\",\n      children: [\"容易忽视冰山之下的设计\", _jsx(_components.a, {\n        className: \"anchor after\",\n        \"aria-hidden\": true,\n        \"aria-label\": \"permalink\",\n        tabIndex: \"-1\",\n        href: \"#容易忽视冰山之下的设计\",\n        children: _jsx(_components.svg, {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 16 16\",\n          focusable: \"false\",\n          children: _jsx(_components.path, {\n            d: \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\",\n            fillRule: \"evenodd\"\n          })\n        })\n      })]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"内部 DSL 的设计要点在于表现层是否流畅，而缺乏对底层领域模型的抽象封装要求。而这很可能导致 DSL 的「核」是缺乏有效设计的。在实践 DSL 时，我们在领域模型这层仍然要遵循最佳编程实践，比如本文 \", _jsx(_components.code, {\n        children: \"(2).weeks.later\"\n      }), \" 背后的 \", _jsx(_components.code, {\n        children: \"Duration\"\n      }), \" 等领域模型实体。\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"作者曾为内部一个历史悠久的庞大前端框架扩展了一个类似 jQuery 的流畅 API 的接口，去掉注释仅仅花费了\", _jsx(_components.a, {\n        href: \"https://github.com/genify/nej/blob/master/src/util/chain/NodeList.js\",\n        children: \"不到 500 行的代码\"\n      }), \"，这个绝大部分归功于框架底层的深厚设计功底和一致性，而非上层的 DSL 语法糖包装。\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"此外在 DSL 设计中，语法和语义同样重要，上述诸多例子也证明了：语法的简洁不一定带来流畅性，必须要结合语义模型来设计。\"\n    }), \"\\n\", _jsxs(_components.blockquote, {\n      children: [\"\\n\", _jsx(_components.p, {\n        children: \"关于语法与语义：\\na || b 和 a or b 语法不同，但语义相同；而 a \u003e b (Java) 和 a \u003e b (Shell) 语法相同，但语义不同\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"这部分建议在外部 DSL 的设计工作中也同样重要。\"\n    }), \"\\n\", _jsxs(_components.h5, {\n      id: \"编辑器支持\",\n      children: [\"编辑器支持\", _jsx(_components.a, {\n        className: \"anchor after\",\n        \"aria-hidden\": true,\n        \"aria-label\": \"permalink\",\n        tabIndex: \"-1\",\n        href: \"#编辑器支持\",\n        children: _jsx(_components.svg, {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 16 16\",\n          focusable: \"false\",\n          children: _jsx(_components.path, {\n            d: \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\",\n            fillRule: \"evenodd\"\n          })\n        })\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"有些内部 DSL 依赖排版来达到最佳表现，绝大部分语言（包括外部 DSL）的自动格式化引擎都是基于语法树解析来实现的，但内部 DSL 就没那么幸运了，由于它在实际语法层面并没有定义，所以经常会发生在编辑器使用「Format Document」后前功尽弃的情况，这类现象在基于缩进的语言中会比较少。\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"特殊的代码高亮就更难了，即使是自动补全，也需要一些额外的工作才能被支持。\"\n    }), \"\\n\", _jsxs(_components.h5, {\n      id: \"小结\",\n      children: [\"小结\", _jsx(_components.a, {\n        className: \"anchor after\",\n        \"aria-hidden\": true,\n        \"aria-label\": \"permalink\",\n        tabIndex: \"-1\",\n        href: \"#小结\",\n        children: _jsx(_components.svg, {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 16 16\",\n          focusable: \"false\",\n          children: _jsx(_components.path, {\n            d: \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\",\n            fillRule: \"evenodd\"\n          })\n        })\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"常规编程解决思路下表达更多的是「How」即如何实现的细节，牵扯进的表达式、语句和数据结构等编程元素会影响到领域工作者对本源问题的理解。而 DSL 的秘诀在于它强调表达是「What」，将原本的命令式编程转化为极致的声明式表述，使得 DSL 具备强大的自解释性（self-explanatory），从而提高编程效率，甚至可以赋能给没有编程经验的用户。\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"进一步阅读以下书籍或资料可以帮助你进一步学习：\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.a, {\n          href: \"https://book.douban.com/subject/21964984/\",\n          children: \"《领域特定语言》\"\n        }), \" - Martin Fowler\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.a, {\n          href: \"https://book.douban.com/subject/25741352/\",\n          children: \"《领域专用语言实战》\"\n        }), \" - Debasish Ghosh\"]\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [_jsx(_components.a, {\n          href: \"http://www.ruanyifeng.com/blog/2011/06/birth_of_javascript.html\",\n          children: \"javascript 诞生记\"\n        }), \" - 阮一峰\"]\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://blog.hellojs.org/declarative-programming-is-it-a-real-thing-e59fe5e893fd\",\n          children: \"Declarative programming is it a real thing?\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://draveness.me/dsl/\",\n          children: \"谈谈 DSL 以及 DSL 的应用（以 CocoaPods 为例）\"\n        })\n      }), \"\\n\", _jsx(_components.li, {\n        children: _jsx(_components.a, {\n          href: \"https://www.cnblogs.com/weidagang2046/archive/2011/10/30/2229293.html\",\n          children: \"用流畅接口构造内部 DSL\"\n        })\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.h2, {\n      id: \"外部-dsl--前端-dsl-实践总结\",\n      children: [\"外部 DSL + 前端 DSL 实践总结\", _jsx(_components.a, {\n        className: \"anchor after\",\n        \"aria-hidden\": true,\n        \"aria-label\": \"permalink\",\n        tabIndex: \"-1\",\n        href: \"#外部-dsl--前端-dsl-实践总结\",\n        children: _jsx(_components.svg, {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 16 16\",\n          focusable: \"false\",\n          children: _jsx(_components.path, {\n            d: \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\",\n            fillRule: \"evenodd\"\n          })\n        })\n      })]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  title,\n  tags,\n  type,\n  avatar,\n  reference,\n  default: MDXContent\n};\n","toc":[{"depth":2,"value":"前言","id":"前言"},{"depth":2,"value":"DSL 初识","id":"dsl-初识","children":[{"depth":4,"value":"编程语言的发展其实是一个不断抽象的过程","id":"编程语言的发展其实是一个不断抽象的过程"},{"depth":4,"value":"外部 DSL","id":"外部-dsl"},{"depth":4,"value":"内部 DSL","id":"内部-dsl"}]},{"depth":2,"value":"内部 DSL","id":"内部-dsl-1","children":[{"depth":4,"value":"风格 1：级联方法","id":"风格-1级联方法"},{"depth":4,"value":"风格 2：级联管道","id":"风格-2级联管道"},{"depth":4,"value":"风格 3：级联属性","id":"风格-3级联属性"},{"depth":4,"value":"风格 4：嵌套函数","id":"风格-4嵌套函数"},{"depth":4,"value":"风格 5：对象字面量","id":"风格-5对象字面量"},{"depth":4,"value":"风格 6：动态代理","id":"风格-6动态代理"},{"depth":4,"value":"风格 7：Lambda 表达式","id":"风格-7lambda-表达式"},{"depth":4,"value":"风格 8：自然语言抽象","id":"风格-8自然语言抽象"},{"depth":4,"value":"总结","id":"总结","children":[{"depth":5,"value":"JS, why?","id":"js-why"},{"depth":5,"value":"库（接口）还是内部 DSL","id":"库接口还是内部-dsl"}]},{"depth":4,"value":"内部 DSL 实践的一些坑","id":"内部-dsl-实践的一些坑","children":[{"depth":5,"value":"不友好的异常","id":"不友好的异常"},{"depth":5,"value":"容易忽视冰山之下的设计","id":"容易忽视冰山之下的设计"},{"depth":5,"value":"编辑器支持","id":"编辑器支持"},{"depth":5,"value":"小结","id":"小结"}]}]},{"depth":2,"value":"外部 DSL + 前端 DSL 实践总结","id":"外部-dsl--前端-dsl-实践总结"}]},"overview":[{"length":21,"name":"archive"},{"length":15,"name":"graphics"},{"length":1,"name":"math"},{"length":8,"name":"network"}]},"__N_SSG":true},"page":"/[collection]/[...slug]","query":{"collection":"archive","slug":["dsl"]},"buildId":"meNayWSLCpwIRBFSyCCZM","assetPrefix":"/blog","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>