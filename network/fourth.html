<!DOCTYPE html><html lang="cn"><head><meta charSet="UTF-8"/><title>第四章 | Network</title><meta name="viewport" content="width=device-width, initial-scale=1"/><meta property="og:title" content="第四章 | Network"/><meta name="description" content="Personal Blog"/><meta property="og:description" content="Personal Blog"/><meta property="og:type" content="website"/><meta property="twitter:card" content="summary_large_image"/><link rel="icon" type="image/x-icon" href="/favicon.ico"/><meta name="next-head-count" content="9"/><link data-next-font="" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/blog/_next/static/css/5f7c6aaf759aa20d.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/5f7c6aaf759aa20d.css" data-n-g=""/><link rel="preload" href="/blog/_next/static/css/b8491e953adc923d.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/b8491e953adc923d.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/blog/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/blog/_next/static/chunks/webpack-6965b024cefed38b.js" defer=""></script><script src="/blog/_next/static/chunks/framework-49c6cecf1f6d5795.js" defer=""></script><script src="/blog/_next/static/chunks/main-aa6243415bc34dcf.js" defer=""></script><script src="/blog/_next/static/chunks/pages/_app-ae897f29056b30d9.js" defer=""></script><script src="/blog/_next/static/chunks/29107295-2a9ca7f07685bf37.js" defer=""></script><script src="/blog/_next/static/chunks/117b9d7f-c05aadfcc1af22be.js" defer=""></script><script src="/blog/_next/static/chunks/664-d254d21a6fe56bff.js" defer=""></script><script src="/blog/_next/static/chunks/547-b11266f3fff918ea.js" defer=""></script><script src="/blog/_next/static/chunks/110-81615c5eece2025a.js" defer=""></script><script src="/blog/_next/static/chunks/675-d64d4792f164bc88.js" defer=""></script><script src="/blog/_next/static/chunks/454-7f4dd88afbda086d.js" defer=""></script><script src="/blog/_next/static/chunks/pages/%5Bcollection%5D/%5B...slug%5D-ff6df9841d375177.js" defer=""></script><script src="/blog/_next/static/mOlT7iX02CiRvniF626pw/_buildManifest.js" defer=""></script><script src="/blog/_next/static/mOlT7iX02CiRvniF626pw/_ssgManifest.js" defer=""></script></head><body><div id="__next"><header data-theme="dark" class="style_nav-root__jrAJR" style="height:80px"><section class="style_nav-section__sS_tB"><a class="style_nav-logo__jRYAT" href="/blog"><h3>Allen Lee@Collections</h3></a><nav aria-label="Main" data-orientation="horizontal" dir="ltr" class="style_nav-menus__4aQM9"><div style="position:relative"><ul data-orientation="horizontal" dir="ltr"><li><button class="style_btn__AkQj7 style_subtle__i70rQ style_nav-trigger__ekUye" id="radix-:Rj6:-trigger-radix-:Rjj6:" data-state="closed" aria-expanded="false" aria-controls="radix-:Rj6:-content-radix-:Rjj6:" data-radix-collection-item="">Overview <svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 15 15" aria-hidden="true" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.18179 6.18181C4.35753 6.00608 4.64245 6.00608 4.81819 6.18181L7.49999 8.86362L10.1818 6.18181C10.3575 6.00608 10.6424 6.00608 10.8182 6.18181C10.9939 6.35755 10.9939 6.64247 10.8182 6.81821L7.81819 9.81821C7.73379 9.9026 7.61934 9.95001 7.49999 9.95001C7.38064 9.95001 7.26618 9.9026 7.18179 9.81821L4.18179 6.81821C4.00605 6.64247 4.00605 6.35755 4.18179 6.18181Z" fill="currentColor"></path></svg></button></li></ul></div></nav></section></header><main data-theme="light" style="background-color:var(--colorNeutralBackground1);overflow-x:hidden;overflow-y:auto;width:100vw;height:calc(100vh - 80px)" id="main"><div class="collection_slug_Root__xztwf"><div class="styles_netPost__eLnJE" style="max-width:960px;font-family:YaHei, Helvetica, arial, sans-serif;font-size:16px"><h1>第四章</h1><p>网络层由数据平面实现转发，控制平面实现路由选择</p>
<p>数据平面只涉及如何<em>决定到达路由器输入链路的数据报如何被转发</em>，转发通常由硬件实现</p>
<p>控制平面只涉及如何<em>控制数据报在路由器之间的路由方式</em>，路由选择通常由软件实现</p>
<p>因特网网络层提供单一服务，称为<strong>尽力而为服务(best-effort service)</strong>，尽力但不保证</p>
<h2 id="路由器">路由器<a class="anchor after" aria-hidden="true" aria-label="permalink" tabindex="-1" href="/blog/network/fourth#%E8%B7%AF%E7%94%B1%E5%99%A8"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" focusable="false"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a></h2>
<p>路由器的端口是物理上意义的(如水晶母头)
</p>
<figure role="figure"><span class="resp-image-wrapper" style="display:flex;align-items:center;justify-content:center;position:relative"><a target="_blank" rel="noopener" style="display:block" href="/blog/images/network/router_architecture.webp"><img crossorigin="anonymous" alt="router_architecture" loading="lazy" width="645" height="384" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 645 384&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAACCAIAAADwyuo0AAAACXBIWXMAAAPoAAAD6AG1e1JrAAAAIklEQVR4nGP4/etLYXpMTLBrSpQPQ293mxgngwQfg6wYCwCUewg2gXzbvwAAAABJRU5ErkJggg==&#x27;/%3E%3C/svg%3E&quot;)" src="/blog/images/network/router_architecture.webp"/></a></span><figcaption role="figcaption">router_architecture</figcaption></figure>
<ul>
<li>输入端口执行终结物理层功能、和位于链路远端的数据链路层交互执行数据链路层功能、查询转发表执行转发功能</li>
<li>交换结构对输入端口和输出端口进行连接</li>
<li>输出端口存储接收的分组，并执行必要的链路层物理层功能</li>
<li>路由选择处理器执行控制平面功能，如更新转发表</li>
</ul>
<p>路由器表通常通过<strong>前缀匹配</strong>来进行转发，当有多个匹配时，使用<strong>最长前缀匹配规则(longest prefix matching rule)</strong></p>
<p>硬件通常采用<strong>三态内容可寻址存储器(Tenary Content Address Memory, TCAM)<strong>来实现查找转发表
<figure role="figure"><span class="resp-image-wrapper" style="display:flex;align-items:center;justify-content:center;position:relative"><a target="_blank" rel="noopener" style="display:block" href="/blog/images/network/three_routing_technologies.webp"><img crossorigin="anonymous" alt="three_routing_technologies" loading="lazy" width="867" height="583" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 867 583&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAIAAAA7ljmRAAAACXBIWXMAAAPoAAAD6AG1e1JrAAAAMElEQVR4nGNICHZfv2jy9RO73j+8ymCjpzqlpeL/nzedtUUMSqKsYW6WbRVZE5pKAYR9ElsyQ7mUAAAAAElFTkSuQmCC&#x27;/%3E%3C/svg%3E&quot;)" src="/blog/images/network/three_routing_technologies.webp"/></a></span><figcaption role="figcaption">three_routing_technologies</figcaption></figure>
如果出现输出端口竞争，将导致输入端口发生</strong>线路前部阻塞(Head-Of-the-Line, HOL)</strong></p>
<p>如果出现输出端口阻塞，将有两种策略：弃尾或删头也可以在填满之前标记，这些策略统称为<strong>主动队列管理(Active Queue Management, AQM)</strong>，其中较重要的算法称为<strong>随机早期检测(Random Early Detection, RED)</strong></p>
<p>缓存长度 B:</p>
<ul>
<li>经验公式: B = 平均往返时延 RTT × 链路容量 C</li>
<li>新进研究: B = RTT × C / √TCP 流数量 N</li>
</ul>
<h2 id="网际协议-ip">网际协议 IP<a class="anchor after" aria-hidden="true" aria-label="permalink" tabindex="-1" href="/blog/network/fourth#%E7%BD%91%E9%99%85%E5%8D%8F%E8%AE%AE-ip"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" focusable="false"><path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd"></path></svg></a></h2>
<p></p>
<figure role="figure"><span class="resp-image-wrapper" style="display:flex;align-items:center;justify-content:center;position:relative"><a target="_blank" rel="noopener" style="display:block" href="/blog/images/network/ipv4_message.webp"><img crossorigin="anonymous" alt="ipv4_message" loading="lazy" width="595" height="528" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 595 528&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAIAAAAmkwkpAAAACXBIWXMAAAPoAAAD6AG1e1JrAAAAPElEQVR4nGP4//X1/++v2krTNYUZGJZO7zu7b1NsgLsMAwPDlI761fOnlWXGgTjLZ0+6de7Ioc3LtSU4AKZsF/D81dkTAAAAAElFTkSuQmCC&#x27;/%3E%3C/svg%3E&quot;)" src="/blog/images/network/ipv4_message.webp"/></a></span><figcaption role="figcaption">ipv4_message</figcaption></figure>
<ul>
<li>标识、标志、片偏移指示 IP 分片信息</li>
<li>寿命(Time-To-Live)，保证数据报不会永远在网络中循环。每个路由器处理后该字段-1，为 0 丢弃</li>
<li>上层协议号作用类似于运输层的端口号</li>
<li>检验和通过对首部中的每两个字节当做一个数，之后求反码并求和得出</li>
</ul>
<p>由于各个链路层协议的 MTU 不同，在不同的链路上将会被拆解成片，因此 IPv4 在接收端系统上将对数据报按照标识、标志和片偏移信息来进行组装</p>
<p><strong>DHCP(动态主机配置协议, Dynamic Host Configuration)协议</strong>按照 4 个步骤分配地址：</p>
<ol>
<li>DHCP 服务器发现，通过**DHCP 发现报文(DHCP discover message)**完成。使用 0.0.0.0 并广播地址 255.255.255.255 来广播</li>
<li>DHCP 服务器提供，DHCP 服务器使用**DHCP 提供报文(DHCP offer message)**完成。使用本机 IP 并广播</li>
<li>DHCP 请求，主机通过**DHCP 请求报文(DHCP request message)**响应</li>
<li>DHCP ACK，服务器使用<strong>DHCP ACK 报文</strong>响应</li>
</ol>
<p>**网络地址转换(Network Address Translation, NAT)<strong>用于扩展 IP 地址范围。NAT 使用 IP 地址+端口号的方式映射局域网内的地址。因此 NAT&quot;路由器&quot;并不是传统意义上的路由器。NAT 可以通过</strong>NAT 穿越(NAT traversal)<strong>工具或</strong>通用即插即用协议(Universal Plug and Play, UPnP)**来修改
</p>
<figure role="figure"><span class="resp-image-wrapper" style="display:flex;align-items:center;justify-content:center;position:relative"><a target="_blank" rel="noopener" style="display:block" href="/blog/images/network/ipv6_message.webp"><img crossorigin="anonymous" alt="ipv6_message" loading="lazy" width="396" height="313" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 396 313&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAIAAAA7ljmRAAAACXBIWXMAAAPoAAAD6AG1e1JrAAAAMElEQVR4nGP48+fnwUN7KsuLCgvSGXbv2JaWHC8vJ66hJs8wfWJviK+bICeDgpQAAHwWDu1z+n4qAAAAAElFTkSuQmCC&#x27;/%3E%3C/svg%3E&quot;)" src="/blog/images/network/ipv6_message.webp"/></a></span><figcaption role="figcaption">ipv6_message</figcaption></figure>
<ul>
<li>IPv6 将地址容量从 32bit 扩展到了 128bit</li>
<li>首部长度固定为 40 字节</li>
<li>流量类型和 IPv4 服务类型字段含义类似</li>
<li>下一个首部含义和 IPv4 的上层协议字段相同</li>
<li>跳限制含义和 IPv4 的寿命字段相同</li>
</ul>
<p>IPv6 不允许路由器分片或组装，只能在端系统上进行。如果发生数据报太大，路由器将丢弃该数据报，并回答一个 ICMP 差错报文
**建隧道(tunneling)**是从 IPv4 迁移到 IPv6 的一种方法。使用 IPv4 的数据报包裹 IPv6，并指示上层协议号为 41 即可</p></div></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"matter":{"date":"2018-01-26","title":"第四章","tags":["network"],"index":4},"absPath":"/home/runner/work/blog/blog/renderer/mdx/network/fourth.mdx","type":"mdx","slug":["fourth"],"collection":"network","url":"/network/fourth"},"compiled":{"content":"\"use strict\";\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst frontmatter = {\n  \"date\": \"2018-01-26\",\n  \"title\": \"第四章\",\n  \"tags\": [\"network\"],\n  \"index\": 4\n};\nfunction _createMdxContent(props) {\n  const _components = {\n    a: \"a\",\n    em: \"em\",\n    h2: \"h2\",\n    img: \"img\",\n    li: \"li\",\n    ol: \"ol\",\n    p: \"p\",\n    path: \"path\",\n    strong: \"strong\",\n    svg: \"svg\",\n    ul: \"ul\",\n    ...props.components\n  };\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.p, {\n      children: \"网络层由数据平面实现转发，控制平面实现路由选择\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"数据平面只涉及如何\", _jsx(_components.em, {\n        children: \"决定到达路由器输入链路的数据报如何被转发\"\n      }), \"，转发通常由硬件实现\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"控制平面只涉及如何\", _jsx(_components.em, {\n        children: \"控制数据报在路由器之间的路由方式\"\n      }), \"，路由选择通常由软件实现\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"因特网网络层提供单一服务，称为\", _jsx(_components.strong, {\n        children: \"尽力而为服务(best-effort service)\"\n      }), \"，尽力但不保证\"]\n    }), \"\\n\", _jsxs(_components.h2, {\n      id: \"路由器\",\n      children: [\"路由器\", _jsx(_components.a, {\n        className: \"anchor after\",\n        \"aria-hidden\": true,\n        \"aria-label\": \"permalink\",\n        tabIndex: \"-1\",\n        href: \"#路由器\",\n        children: _jsx(_components.svg, {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 16 16\",\n          focusable: \"false\",\n          children: _jsx(_components.path, {\n            d: \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\",\n            fillRule: \"evenodd\"\n          })\n        })\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"路由器的端口是物理上意义的(如水晶母头)\\n\"\n    }), \"\\n\", _jsx(_components.img, {\n      src: \"/images/network/router_architecture.webp\",\n      alt: \"router_architecture\",\n      width: \"645\",\n      height: \"384\",\n      sizes: \"(max-width: 645px) 100vw, 384px\",\n      blurDataURL: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAACCAIAAADwyuo0AAAACXBIWXMAAAPoAAAD6AG1e1JrAAAAIklEQVR4nGP4/etLYXpMTLBrSpQPQ293mxgngwQfg6wYCwCUewg2gXzbvwAAAABJRU5ErkJggg==\",\n      placeholder: \"blur\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"输入端口执行终结物理层功能、和位于链路远端的数据链路层交互执行数据链路层功能、查询转发表执行转发功能\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"交换结构对输入端口和输出端口进行连接\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"输出端口存储接收的分组，并执行必要的链路层物理层功能\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"路由选择处理器执行控制平面功能，如更新转发表\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"路由器表通常通过\", _jsx(_components.strong, {\n        children: \"前缀匹配\"\n      }), \"来进行转发，当有多个匹配时，使用\", _jsx(_components.strong, {\n        children: \"最长前缀匹配规则(longest prefix matching rule)\"\n      })]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"硬件通常采用\", _jsxs(_components.strong, {\n        children: [\"三态内容可寻址存储器(Tenary Content Address Memory, TCAM)\", _jsxs(_components.strong, {\n          children: [\"来实现查找转发表\\n\", _jsx(_components.img, {\n            src: \"/images/network/three_routing_technologies.webp\",\n            alt: \"three_routing_technologies\",\n            width: \"867\",\n            height: \"583\",\n            sizes: \"(max-width: 867px) 100vw, 583px\",\n            blurDataURL: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAIAAAA7ljmRAAAACXBIWXMAAAPoAAAD6AG1e1JrAAAAMElEQVR4nGNICHZfv2jy9RO73j+8ymCjpzqlpeL/nzedtUUMSqKsYW6WbRVZE5pKAYR9ElsyQ7mUAAAAAElFTkSuQmCC\",\n            placeholder: \"blur\"\n          }), \"\\n如果出现输出端口竞争，将导致输入端口发生\"]\n        }), \"线路前部阻塞(Head-Of-the-Line, HOL)\"]\n      })]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"如果出现输出端口阻塞，将有两种策略：弃尾或删头也可以在填满之前标记，这些策略统称为\", _jsx(_components.strong, {\n        children: \"主动队列管理(Active Queue Management, AQM)\"\n      }), \"，其中较重要的算法称为\", _jsx(_components.strong, {\n        children: \"随机早期检测(Random Early Detection, RED)\"\n      })]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"缓存长度 B:\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"经验公式: B = 平均往返时延 RTT × 链路容量 C\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"新进研究: B = RTT × C / √TCP 流数量 N\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.h2, {\n      id: \"网际协议-ip\",\n      children: [\"网际协议 IP\", _jsx(_components.a, {\n        className: \"anchor after\",\n        \"aria-hidden\": true,\n        \"aria-label\": \"permalink\",\n        tabIndex: \"-1\",\n        href: \"#网际协议-ip\",\n        children: _jsx(_components.svg, {\n          xmlns: \"http://www.w3.org/2000/svg\",\n          width: \"16\",\n          height: \"16\",\n          viewBox: \"0 0 16 16\",\n          focusable: \"false\",\n          children: _jsx(_components.path, {\n            d: \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\",\n            fillRule: \"evenodd\"\n          })\n        })\n      })]\n    }), \"\\n\", _jsx(_components.p, {}), \"\\n\", _jsx(_components.img, {\n      src: \"/images/network/ipv4_message.webp\",\n      alt: \"ipv4_message\",\n      width: \"595\",\n      height: \"528\",\n      sizes: \"(max-width: 595px) 100vw, 528px\",\n      blurDataURL: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAIAAAAmkwkpAAAACXBIWXMAAAPoAAAD6AG1e1JrAAAAPElEQVR4nGP4//X1/++v2krTNYUZGJZO7zu7b1NsgLsMAwPDlI761fOnlWXGgTjLZ0+6de7Ioc3LtSU4AKZsF/D81dkTAAAAAElFTkSuQmCC\",\n      placeholder: \"blur\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"标识、标志、片偏移指示 IP 分片信息\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"寿命(Time-To-Live)，保证数据报不会永远在网络中循环。每个路由器处理后该字段-1，为 0 丢弃\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"上层协议号作用类似于运输层的端口号\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"检验和通过对首部中的每两个字节当做一个数，之后求反码并求和得出\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"由于各个链路层协议的 MTU 不同，在不同的链路上将会被拆解成片，因此 IPv4 在接收端系统上将对数据报按照标识、标志和片偏移信息来进行组装\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [_jsx(_components.strong, {\n        children: \"DHCP(动态主机配置协议, Dynamic Host Configuration)协议\"\n      }), \"按照 4 个步骤分配地址：\"]\n    }), \"\\n\", _jsxs(_components.ol, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"DHCP 服务器发现，通过**DHCP 发现报文(DHCP discover message)**完成。使用 0.0.0.0 并广播地址 255.255.255.255 来广播\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"DHCP 服务器提供，DHCP 服务器使用**DHCP 提供报文(DHCP offer message)**完成。使用本机 IP 并广播\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"DHCP 请求，主机通过**DHCP 请求报文(DHCP request message)**响应\"\n      }), \"\\n\", _jsxs(_components.li, {\n        children: [\"DHCP ACK，服务器使用\", _jsx(_components.strong, {\n          children: \"DHCP ACK 报文\"\n        }), \"响应\"]\n      }), \"\\n\"]\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"**网络地址转换(Network Address Translation, NAT)\", _jsx(_components.strong, {\n        children: \"用于扩展 IP 地址范围。NAT 使用 IP 地址+端口号的方式映射局域网内的地址。因此 NAT\\\"路由器\\\"并不是传统意义上的路由器。NAT 可以通过\"\n      }), \"NAT 穿越(NAT traversal)\", _jsx(_components.strong, {\n        children: \"工具或\"\n      }), \"通用即插即用协议(Universal Plug and Play, UPnP)**来修改\\n\"]\n    }), \"\\n\", _jsx(_components.img, {\n      src: \"/images/network/ipv6_message.webp\",\n      alt: \"ipv6_message\",\n      width: \"396\",\n      height: \"313\",\n      sizes: \"(max-width: 396px) 100vw, 313px\",\n      blurDataURL: \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAIAAAA7ljmRAAAACXBIWXMAAAPoAAAD6AG1e1JrAAAAMElEQVR4nGP48+fnwUN7KsuLCgvSGXbv2JaWHC8vJ66hJs8wfWJviK+bICeDgpQAAHwWDu1z+n4qAAAAAElFTkSuQmCC\",\n      placeholder: \"blur\"\n    }), \"\\n\", _jsxs(_components.ul, {\n      children: [\"\\n\", _jsx(_components.li, {\n        children: \"IPv6 将地址容量从 32bit 扩展到了 128bit\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"首部长度固定为 40 字节\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"流量类型和 IPv4 服务类型字段含义类似\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"下一个首部含义和 IPv4 的上层协议字段相同\"\n      }), \"\\n\", _jsx(_components.li, {\n        children: \"跳限制含义和 IPv4 的寿命字段相同\"\n      }), \"\\n\"]\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"IPv6 不允许路由器分片或组装，只能在端系统上进行。如果发生数据报太大，路由器将丢弃该数据报，并回答一个 ICMP 差错报文\\n**建隧道(tunneling)**是从 IPv4 迁移到 IPv6 的一种方法。使用 IPv4 的数据报包裹 IPv6，并指示上层协议号为 41 即可\"\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = props.components || ({});\n  return MDXLayout ? _jsx(MDXLayout, {\n    ...props,\n    children: _jsx(_createMdxContent, {\n      ...props\n    })\n  }) : _createMdxContent(props);\n}\nreturn {\n  frontmatter,\n  default: MDXContent\n};\n","toc":[{"depth":2,"value":"路由器","id":"路由器"},{"depth":2,"value":"网际协议 IP","id":"网际协议-ip"}]},"overview":[{"length":22,"name":"archive"},{"length":15,"name":"graphics"},{"length":1,"name":"math"},{"length":8,"name":"network"},{"length":2,"name":"sstory"},{"name":"practice","length":5}]},"__N_SSG":true},"page":"/[collection]/[...slug]","query":{"collection":"network","slug":["fourth"]},"buildId":"mOlT7iX02CiRvniF626pw","assetPrefix":"/blog","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>