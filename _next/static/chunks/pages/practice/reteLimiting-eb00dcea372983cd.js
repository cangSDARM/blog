(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[989],{8177:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/practice/reteLimiting",function(){return s(4648)}])},6472:function(e,t,s){"use strict";var r=s(5893),n=s(512),i=s(7294),a=s(9489),l=s.n(a);let c=i.forwardRef((e,t)=>{let{children:s,appearance:i,className:a,...c}=e;return(0,r.jsx)("button",{className:(0,n.Z)(l().btn,"subtle"===i&&l().subtle,"transparent"===i&&l().transparent,a),...c,ref:t,children:s})});t.Z=c},3083:function(e,t,s){"use strict";s.d(t,{Z:function(){return w},_:function(){return k}});var r=s(5893),n=s(7294);let i=n.createContext({overview:[]}),a=e=>{let{overview:t,children:s}=e;return(0,r.jsx)(i.Provider,{value:{overview:t},children:s})},l=()=>n.useContext(i);var c=s(9971),d=s(512),o=s(6472),u=s(6486),h=s.n(u),x=s(7855),j=s(5308),m=s.n(j),p=s(4316),v=s(9213),f=s(1664),y=s.n(f);let g=n.forwardRef((e,t)=>{let{children:s,title:n,href:i="",...a}=e;return(0,r.jsx)("li",{className:m().item,children:(0,r.jsxs)(y(),{href:i,...a,ref:t,children:[(0,r.jsx)(v.Z,{as:"title",children:n}),(0,r.jsx)(v.Z,{as:"p",maxLines:2,children:s})]})})});var _=e=>{let{imgSrc:t,fileList:s=[]}=e;return(0,r.jsxs)("div",{className:m().preview,children:[(0,r.jsx)("div",{"data-layer":"bg",style:{backgroundImage:"url(".concat(t,")")}}),(0,r.jsx)("ul",{"data-layer":"list",children:s.map(e=>{var t,s;return(0,r.jsx)(g,{href:e.url,title:e.frontmatter.title,children:(null===(t=e.rawContent)||void 0===t?void 0:t.substring(0,64))||(null===(s=e.frontmatter)||void 0===s?void 0:s.date)},e.file)})})]})},b=e=>{let{imgSrc:t,topic:s="",fileList:n=[],style:i}=e,a=(0,x.X)(),{overview:u}=l();return(0,r.jsx)("header",{"data-theme":"dark",className:m()["nav-root"],style:i,children:(0,r.jsxs)("section",{className:m()["nav-section"],children:[(0,r.jsx)(y(),{className:m()["nav-logo"],href:"/",children:(0,r.jsx)("h3",{children:"Allen Lee@Collections"})}),(0,r.jsxs)(p.fC,{className:m()["nav-menus"],children:[(0,r.jsxs)(p.aV,{children:[s&&(0,r.jsxs)(p.ck,{children:[(0,r.jsx)(p.xz,{className:m()["nav-trigger"],asChild:!0,children:(0,r.jsxs)(o.Z,{appearance:"subtle",children:[h().capitalize(s),(0,r.jsx)(c.jX5,{"aria-hidden":!0})]})}),(0,r.jsx)(p.VY,{className:m()["nav-surface"],children:(0,r.jsx)(_,{imgSrc:t,fileList:n})})]}),(0,r.jsxs)(p.ck,{children:[(0,r.jsx)(p.xz,{className:m()["nav-trigger"],asChild:!0,children:(0,r.jsxs)(o.Z,{appearance:"subtle",children:["Overview ",(0,r.jsx)(c.jX5,{"aria-hidden":!0})]})}),(0,r.jsx)(p.VY,{className:m()["nav-surface"],children:(0,r.jsx)("ul",{className:m().overviews,children:u.map(e=>(0,r.jsx)("li",{children:(0,r.jsxs)(y(),{href:"/tags/"+e.name,children:[(0,r.jsx)("span",{children:e.name}),(0,r.jsx)("span",{"data-layer":"count",children:e.length||0})]})},e.name))})})]}),(0,r.jsx)(p.z$,{className:m()["nav-indicator"],children:(0,r.jsx)("i",{})})]}),(0,r.jsx)(p.l_,{className:(0,d.Z)(m()["nav-viewport"],a)})]})]})})};function k(e){let t=t=>{let{overview:s,...n}=t;return(0,r.jsx)(a,{overview:s,children:(0,r.jsx)(e,{...n})})};return t.displayName="InjectedComponent",t}var w=e=>{let{children:t,theme:s}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b,{imgSrc:"",style:{height:80}}),(0,r.jsx)("main",{"data-theme":s,style:{backgroundColor:"var(--colorNeutralBackground1)",overflowX:"hidden",overflowY:"auto",width:"100vw",height:"calc(100vh - ".concat(80,"px)")},id:"main",children:t})]})}},5376:function(e,t,s){"use strict";var r=s(5893),n=s(9008),i=s.n(n),a=s(1685);s(7294),t.Z=e=>{let{title:t="",titleTemplate:s="%s",meta:n=[]}=e,l=s.replace("%s",t||a.Z.site.title);return(0,r.jsxs)(i(),{children:[(0,r.jsx)("meta",{charSet:"UTF-8"}),(0,r.jsx)("title",{children:l}),(0,r.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,r.jsx)("meta",{property:"og:title",content:l},"og:title"),(0,r.jsx)("meta",{name:"description",content:a.Z.site.description},"meta:description"),(0,r.jsx)("meta",{property:"og:description",content:a.Z.site.description},"og:description"),(0,r.jsx)("meta",{property:"og:type",content:"website"}),(0,r.jsx)("meta",{property:"twitter:card",content:"summary_large_image"}),(0,r.jsx)("link",{rel:"icon",type:"image/x-icon",href:"/favicon.ico"}),n.map(e=>(0,r.jsx)("meta",{name:e.name,content:e.content,property:e.property},e.name))]})}},7855:function(e,t,s){"use strict";s.d(t,{X:function(){return c}});var r=s(5893),n=s(7294),i=s(512),a=s(8216),l=s.n(a);function c(){return(null===l()||void 0===l()?void 0:l().surface)||""}let d=n.forwardRef((e,t)=>{let{children:s,appearance:n="primary",className:a,...c}=e;return(0,r.jsx)("section",{className:(0,i.Z)(l().surface,"soft"===n&&l()["soft-surface"],"minimum"===n&&l()["minimum-surface"],a),...c,ref:t,children:s})});d.displayName="surface",t.Z=d},9213:function(e,t,s){"use strict";var r=s(5893),n=s(7294),i=s(8554),a=s(2981),l=s(7855),c=s(512),d=s(110),o=s.n(d);t.Z=e=>{let{children:t,maxLines:s=100,as:d="span",tooltipProps:u={},portalContainInBody:h=!1,...x}=e,[j,m]=n.useState(!1),[p,v]=n.useState(!1),f=n.useRef(null);return(0,r.jsx)(a.zt,{delayDuration:200,skipDelayDuration:100,children:(0,r.jsxs)(a.fC,{open:j,onOpenChange:e=>m(e),children:[(0,r.jsx)(a.xz,{asChild:!0,children:(0,r.jsx)(d,{...x||{},ref:e=>{e&&(f.current=e.parentNode)},children:(0,r.jsx)(i.Z,{lines:s,maxLines:s,withTooltip:!1,children:t})})}),(0,r.jsx)(a.h_,{container:h?document.body:f.current,children:(0,r.jsx)(a.VY,{children:(0,r.jsx)(l.Z,{appearance:"soft",style:{padding:"2px 4px"},...u,children:n.Children.map(t||[],e=>{var t,s;return n.isValidElement(e)?n.cloneElement(e,{className:(0,c.Z)(null==e?void 0:null===(t=e.props)||void 0===t?void 0:t.className,o()["in-tooltip"]),"in-tooltip":"true"}):e?(0,r.jsx)("span",{className:(0,c.Z)(null==e?void 0:null===(s=e.props)||void 0===s?void 0:s.className,o()["in-tooltip"]),"in-tooltip":"true",children:e}):void 0})})})})]})})}},1685:function(e,t){"use strict";t.Z={site:{title:"Allen Blog",description:"Personal Blog",baseUrl:"/blog"}}},4648:function(e,t,s){"use strict";s.r(t),s.d(t,{__N_SSG:function(){return g},default:function(){return _}});var r=s(5893),n=s(5376),i=s(3083),a=s(7294),l=s(6472),c=s(3294),d=s.n(c),o=s(512);let u=a.forwardRef((e,t)=>{let{children:s,className:n}=e;return(0,r.jsx)("div",{className:(0,o.Z)(n,d().card),ref:t,children:s})});u.displayName="card";let h="#afa",x="#aff",j="#faa";var m=()=>{let[e,t]=a.useState(10),[s,n]=a.useState(1),[i,c]=a.useState([]),[o,m]=a.useState(!0),[p,v]=a.useState({totalRequests:0,processedRequests:0,droppedRequests:0,currentBucketSize:0}),[f,y]=a.useState([]),[g,_]=a.useState([]),[b,k]=a.useState([]),w=a.useRef(null),S=a.useRef(0);a.useEffect(()=>(o?w.current=setInterval(()=>{c(e=>{let t=[...e],r=Math.min(s,t.length),n=t.splice(0,r);return n.length>0&&(_(e=>[...e,...n.map(e=>({...e,processTime:Date.now()}))]),v(e=>({...e,processedRequests:e.processedRequests+n.length,currentBucketSize:t.length}))),t})},1e3):clearInterval(w.current),()=>clearInterval(w.current)),[o,s]),a.useEffect(()=>{let e=setInterval(()=>{y(e=>e.filter(e=>Date.now()-e.timestamp<2e3)),_(e=>e.filter(e=>Date.now()-e.processTime<2e3)),k(e=>e.filter(e=>Date.now()-e.dropTime<2e3))},100);return()=>clearInterval(e)},[]);let N=i.length/e*100;return(0,r.jsxs)("div",{className:d().root,children:[(0,r.jsx)("h3",{children:"Leaky Bucket Rate Limiting Simulator"}),(0,r.jsxs)(u,{className:d().controls,children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{children:["Bucket Size",(0,r.jsx)("input",{type:"number",min:"1",max:"20",value:e,onChange:e=>t(parseInt(e.target.value))})]}),(0,r.jsxs)("sub",{children:[e," tokens"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{children:["Fill Rate (req/sec)",(0,r.jsx)("input",{type:"number",min:"1",max:"10",value:s,onChange:e=>n(parseInt(e.target.value))})]}),(0,r.jsxs)("sub",{children:[s,"/second"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(l.Z,{onClick:()=>{let t={id:S.current++,timestamp:Date.now(),processTime:0,dropTime:0};y(e=>[...e,t]),setTimeout(()=>{c(s=>{if(!(s.length<e))return k(e=>[...e,{...t,dropTime:Date.now()}]),v(e=>({...e,totalRequests:e.totalRequests+1,droppedRequests:e.droppedRequests+1})),s;{let e=[...s,t];return v(t=>({...t,totalRequests:t.totalRequests+1,currentBucketSize:e.length})),e}})},1e3)},children:"Send Request"}),(0,r.jsx)(l.Z,{onClick:()=>m(!o),children:o?"Pause":"Start"}),(0,r.jsx)(l.Z,{onClick:()=>{m(!1),c([]),y([]),_([]),k([]),v({totalRequests:0,processedRequests:0,droppedRequests:0,currentBucketSize:0}),S.current=0},children:"Reset"})]})]}),(0,r.jsxs)(u,{className:d().container,children:[(0,r.jsxs)("div",{"data-mode-cs":!0,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{}),(0,r.jsx)("span",{children:"User"})]}),f.map(e=>{let t=Date.now()-e.timestamp;return(0,r.jsx)("div",{className:d().request,style:{left:"".concat(15+35*Math.min(t/1e3,1),"%"),top:"45%",background:h,transform:"translateY(-50%)"}},e.id)}),(0,r.jsxs)("div",{className:d().leakyBucket,children:[(0,r.jsxs)("div",{style:{background:"\n  linear-gradient(\n    to top,\n    #aaFa 0%,\n    #aaFa ".concat(N,"%,\n    transparent ").concat(N,"%,\n    transparent 100%\n  )")},children:[(0,r.jsx)("div",{children:Array.from({length:e},(e,t)=>(0,r.jsx)("div",{style:{background:t<i.length?"#0ffa":"transparent"}},t))}),(0,r.jsx)("div",{children:Array.from({length:Math.min(s,3)},(e,t)=>(0,r.jsx)("div",{},t))})]}),(0,r.jsxs)("span",{children:["Bucket (",i.length,"/",e,")"]})]}),g.map((e,t)=>{let s=Date.now()-e.processTime;return(0,r.jsx)("div",{className:d().request,style:{left:"".concat(50+35*Math.min(s/1e3,1),"%"),top:"45%",background:x,transform:"translateY(-50%)"}},t)}),b.map((e,t)=>{let s=Math.min((Date.now()-e.dropTime)/1500,1);return(0,r.jsx)("div",{className:d().request,style:{background:j,left:"50%",top:"".concat(45+40*s,"%"),transform:"translateX(-50%)",opacity:1-s}},t)}),(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,r.jsx)("div",{}),(0,r.jsx)("span",{children:"Server"}),(0,r.jsxs)("span",{children:[s," req/s"]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{children:"Request Status:"}),(0,r.jsx)("div",{style:{background:h},children:(0,r.jsx)("span",{children:"Moving to Bucket"})}),(0,r.jsx)("div",{style:{background:x},children:(0,r.jsx)("span",{children:"Accepted & Processed"})}),(0,r.jsx)("div",{style:{background:j},children:(0,r.jsx)("span",{children:"Dropped (No Tokens)"})})]})]}),(0,r.jsxs)("div",{className:d().stats,children:[(0,r.jsxs)(u,{children:[(0,r.jsx)("div",{children:p.processedRequests}),(0,r.jsx)("sub",{children:"Processed"})]}),(0,r.jsxs)(u,{children:[(0,r.jsx)("div",{children:p.droppedRequests}),(0,r.jsx)("sub",{children:"Dropped"})]}),(0,r.jsxs)(u,{children:[(0,r.jsx)("div",{children:p.currentBucketSize}),(0,r.jsx)("sub",{children:"In Bucket"})]})]})]})},p=()=>{let[e,t]=a.useState(15),[s,n]=a.useState(3),[i,c]=a.useState(e),[o,h]=a.useState(0),[x,j]=a.useState(0),[m,p]=a.useState(!0),[v,f]=a.useState([]),y=a.useRef(null);return a.useEffect(()=>(m?y.current=setInterval(()=>{c(t=>Math.min(t+s,e))},1e3):y.current&&clearInterval(y.current),()=>{y.current&&clearInterval(y.current)}),[m,s,e]),a.useEffect(()=>{let e=setInterval(()=>{f(e=>e.filter(e=>Date.now()-e.timestamp<3e3))},500);return()=>clearInterval(e)},[]),(0,r.jsxs)("div",{className:d().root,children:[(0,r.jsx)("h3",{children:"Token Bucket Rate Limiter Simulator"}),(0,r.jsxs)(u,{className:d().controls,children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{children:["Bucket Capacity",(0,r.jsx)("input",{type:"number",value:e,onChange:e=>t(Number(e.target.value)),min:1,max:20})]}),(0,r.jsxs)("sub",{children:[e," tokens"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{children:["Refill Rate",(0,r.jsx)("input",{type:"number",value:s,onChange:e=>n(Number(e.target.value)),min:1,max:5})]}),(0,r.jsxs)("sub",{children:[s,"/second"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(l.Z,{onClick:()=>{let e=Math.random().toString(36).substring(2,15),t={id:e,status:"moving",timestamp:Date.now()};f(e=>[...e,t]),setTimeout(()=>{c(t=>t>0?(h(e=>e+1),f(t=>t.map(t=>t.id===e?{...t,status:"accepted"}:t)),t-1):(j(e=>e+1),f(t=>t.map(t=>t.id===e?{...t,status:"dropped"}:t)),t))},800)},children:"Send Request"}),(0,r.jsx)(l.Z,{onClick:()=>p(!m),children:m?(0,r.jsx)(r.Fragment,{children:"Pause"}):(0,r.jsx)(r.Fragment,{children:"Start"})}),(0,r.jsx)(l.Z,{onClick:()=>{p(!1),c(e),h(0),j(0),f([])},children:"Reset"})]})]}),(0,r.jsxs)(u,{className:d().container,children:[(0,r.jsxs)("div",{"data-mode-cs":!0,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{}),(0,r.jsx)("span",{children:"User"})]}),(0,r.jsxs)("div",{className:d().tokensBucket,children:[(0,r.jsx)("div",{children:Array.from({length:e}).map((e,t)=>(0,r.jsx)("div",{className:d().request,style:{transitionDelay:"".concat(30*t,"ms"),background:"#afa",opacity:t<i?1:0}},t))}),(0,r.jsxs)("div",{children:[i,"/",e," tokens"]})]}),v.map(e=>(0,r.jsx)("div",{className:d().request,style:{transitionProperty:"all",transitionDuration:"750ms",left:"moving"===e.status?0:"accepted"===e.status?"80%":"40%",top:"dropped"===e.status?"85%":"50%",translate:"dropped"===e.status?"":"translateY(-50%)",backgroundColor:"moving"===e.status?"#facc15":"accepted"===e.status?"#22c55e":"#ef4444"}},e.id)),(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,r.jsx)("div",{}),(0,r.jsx)("span",{children:"Server"})]})]}),(0,r.jsx)("div",{})]}),(0,r.jsxs)("div",{className:d().stats,style:{gridTemplateColumns:"repeat(4, minmax(0, 1fr))"},children:[(0,r.jsxs)(u,{children:[(0,r.jsx)("div",{children:i}),(0,r.jsx)("sub",{children:"Current Tokens"})]}),(0,r.jsxs)(u,{children:[(0,r.jsx)("div",{children:o}),(0,r.jsx)("sub",{children:"Processed"})]}),(0,r.jsxs)(u,{children:[(0,r.jsx)("div",{children:x}),(0,r.jsx)("sub",{children:"Dropped"})]}),(0,r.jsxs)(u,{children:[(0,r.jsxs)("div",{children:[o+x===0?100:Math.round(o/(o+x)*100),"%"]}),(0,r.jsx)("sub",{children:"Success Rate"})]})]})]})},v=()=>{let[e,t]=a.useState(!1),[s,n]=a.useState(0),[i,c]=a.useState([]),[o,h]=a.useState(5),[x,j]=a.useState(3e3),[m,p]=a.useState(0),[v,f]=a.useState(0),y=a.useRef(null),g=a.useRef(0),_=a.useRef(Date.now());a.useEffect(()=>(e?y.current=setInterval(()=>{n(Date.now()-_.current)},50):clearInterval(y.current),()=>clearInterval(y.current)),[e]);let b=e=>Math.floor(e/x),k=e=>{let t=b(e)*x,s=t+x;return i.filter(e=>e.timestamp>=t&&e.timestamp<s&&"served"===e.status).length},w=b(s)*x,S=Math.max(0,s-5e3),N=i.filter(e=>e.timestamp>=S&&e.timestamp<=s+500);return(0,r.jsxs)("div",{className:d().root,children:[(0,r.jsx)("h3",{children:"Fixed Window Counter Rate Limiter"}),(0,r.jsxs)(u,{className:d().controls,children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{children:["Window Limit (requests)",(0,r.jsx)("input",{type:"number",value:o,onChange:e=>h(Math.max(1,parseInt(e.target.value)||1)),min:"1",max:"20"})]}),(0,r.jsxs)("sub",{children:[o," requests per window"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{children:["Window Duration (ms)",(0,r.jsx)("input",{type:"number",value:x,onChange:e=>j(Math.max(500,parseInt(e.target.value)||1e3)),min:"500",max:"5000",step:"100"})]}),(0,r.jsxs)("sub",{children:[x," ms per window"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)(l.Z,{onClick:()=>{e||(_.current=Date.now()-s),t(!e)},children:[e?"Pause":"Start"," Timer"]}),(0,r.jsx)(l.Z,{onClick:()=>{let e=k(s)<o,t={id:g.current++,timestamp:s,status:e?"served":"rejected",window:b(s)};c(e=>[...e,t]),e?p(e=>e+1):f(e=>e+1)},children:"Send Request"}),(0,r.jsx)(l.Z,{onClick:()=>{t(!1),n(0),c([]),p(0),f(0),_.current=Date.now()},children:"Reset"})]})]}),(0,r.jsxs)(u,{className:d().container,children:[(0,r.jsxs)("div",{style:{position:"absolute",inset:0},children:[(0,r.jsxs)("svg",{style:{position:"absolute",inset:0,width:"100%",height:"100%"},children:[(0,r.jsx)("defs",{children:(0,r.jsx)("pattern",{id:"grid",width:.12*x,height:"20",patternUnits:"userSpaceOnUse",children:(0,r.jsx)("path",{d:"M ".concat(.12*x," 0 L 0 0 0 20"),fill:"none",stroke:"#999",strokeWidth:"1",strokeDasharray:"2,2"})})}),(0,r.jsx)("rect",{width:"100%",height:"100%",fill:"url(#grid)"}),(0,r.jsx)("line",{x1:(s-S)*.12,y1:"0",x2:(s-S)*.12,y2:"100%",stroke:"#3b82f6",strokeWidth:"2"}),(0,r.jsx)("rect",{x:(w-S)*.12,y:"0",width:.12*x,height:"100%",fill:"rgba(59, 130, 246, 0.1)",stroke:"rgba(59, 130, 246, 0.3)",strokeWidth:"2"})]}),N.map(e=>{let t=(e.timestamp-S)*.12,n=50+e.timestamp%200,i="served"===e.status;return(0,r.jsx)("div",{className:d().request,style:{background:i?"#ffa":"#faa",left:"".concat(t-16,"px"),top:"".concat(Math.min(n,250),"px"),transform:"scale(".concat(Math.max(.5,1-(s-e.timestamp)/2e3),")"),opacity:Math.max(.3,1-(s-e.timestamp)/3e3)},title:"".concat(i?"Served":"Rejected"," at ").concat(e.timestamp,"ms")},e.id)}),(0,r.jsx)("div",{style:{position:"absolute",top:0,right:0,left:0,display:"flex",justifyContent:"space-evenly"},children:Array.from({length:6},(e,t)=>{let s=S+5e3*t/5;return(0,r.jsxs)("div",{children:[(s/1e3).toFixed(1),"s"]},t)})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{children:"Request Status:"}),(0,r.jsx)("div",{style:{background:"#ffa"},children:(0,r.jsx)("span",{className:"text-green-500",children:"Served"})}),(0,r.jsx)("div",{style:{background:"#faa"},children:(0,r.jsx)("span",{className:"text-red-500",children:"Rejected"})}),(0,r.jsx)("div",{style:{background:"#aafa"},children:(0,r.jsx)("span",{className:"text-purple-500",children:"Current Window"})})]})]}),(0,r.jsxs)("div",{className:d().stats,children:[(0,r.jsxs)(u,{children:[(0,r.jsx)("div",{children:m}),(0,r.jsx)("sub",{children:"Served"})]}),(0,r.jsxs)(u,{children:[(0,r.jsx)("div",{children:v}),(0,r.jsx)("sub",{children:"Rejected"})]}),(0,r.jsxs)(u,{children:[(0,r.jsx)("div",{children:k(s)}),(0,r.jsx)("sub",{children:"Current Window"})]})]})]})},f=()=>{let[e,t]=a.useState(!1),[s,n]=a.useState(0),[i,c]=a.useState([]),[o,h]=a.useState(5),[x,j]=a.useState(3e3),[m,p]=a.useState(0),[v,f]=a.useState(0),y=a.useRef(null),g=a.useRef(0),_=a.useRef(Date.now());a.useEffect(()=>(e?y.current=setInterval(()=>{n(Date.now()-_.current)},50):clearInterval(y.current),()=>clearInterval(y.current)),[e]);let b=e=>{let t=e-x;return i.filter(s=>s.timestamp>t&&s.timestamp<=e&&"served"===s.status).length},k=Math.max(0,s-6e3),w=i.filter(e=>e.timestamp>=k&&e.timestamp<=s+500);return i.filter(e=>e.timestamp>s-x&&e.timestamp<=s&&"served"===e.status),(0,r.jsxs)("div",{className:d().root,children:[(0,r.jsx)("h3",{children:"Sliding Window Rate Limiter"}),(0,r.jsxs)(u,{className:d().controls,children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{children:["Window Limit (requests)",(0,r.jsx)("input",{type:"number",value:o,onChange:e=>h(Math.max(1,parseInt(e.target.value)||1)),min:"1",max:"20"})]}),(0,r.jsxs)("sub",{children:[o," requests per window"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{children:["Window Duration (ms)",(0,r.jsx)("input",{type:"number",value:x,onChange:e=>j(Math.max(1e3,parseInt(e.target.value)||2e3)),min:"1000",max:"10000",step:"500"})]}),(0,r.jsxs)("sub",{children:[x," ms per window"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)(l.Z,{onClick:()=>{e||(_.current=Date.now()-s),t(!e)},children:[e?"Pause":"Start"," Timer"]}),(0,r.jsx)(l.Z,{onClick:()=>{let e=b(s),t=e<o,r={id:g.current++,timestamp:s,status:t?"served":"rejected",windowCount:e};c(e=>[...e,r]),t?p(e=>e+1):f(e=>e+1)},children:"Send Request"}),(0,r.jsx)(l.Z,{onClick:()=>{t(!1),n(0),c([]),p(0),f(0),_.current=Date.now()},children:"Reset"})]})]}),(0,r.jsxs)(u,{className:d().container,children:[(0,r.jsxs)("div",{style:{position:"absolute",inset:0},children:[(0,r.jsxs)("svg",{style:{position:"absolute",inset:0,width:"100%",height:"100%"},children:[(0,r.jsx)("defs",{children:(0,r.jsx)("pattern",{id:"timeGrid",width:"60",height:"20",patternUnits:"userSpaceOnUse",children:(0,r.jsx)("path",{d:"M 60 0 L 0 0 0 20",fill:"none",stroke:"#999",strokeWidth:"1"})})}),(0,r.jsx)("rect",{width:"100%",height:"100%",fill:"url(#timeGrid)"}),(0,r.jsx)("line",{x1:(s-k)*.1,y1:"0",x2:(s-k)*.1,y2:"300",stroke:"#8b5cf6",strokeWidth:"3"}),(0,r.jsx)("rect",{x:Math.max(0,(s-x-k)*.1),y:"0",width:.1*x,height:"300",fill:"rgba(139, 92, 246, 0.15)",stroke:"rgba(139, 92, 246, 0.4)",strokeWidth:"2",strokeDasharray:"5,5"}),(0,r.jsx)("line",{x1:Math.max(0,(s-x-k)*.1),y1:"0",x2:Math.max(0,(s-x-k)*.1),y2:"300",stroke:"#8b5cf6",strokeWidth:"2",strokeDasharray:"3,3"})]}),w.map(e=>{let t=(e.timestamp-k)*.1,n=50+e.timestamp%180,i="served"===e.status,a=e.timestamp>s-x&&e.timestamp<=s;return(0,r.jsx)("div",{className:d().request,style:{background:i?"#ffa":"#faa",left:"".concat(t-16,"px"),top:"".concat(Math.min(n,250),"px"),transform:"scale(".concat(a?1:.7,")"),opacity:a?1:.5,zIndex:a?10:5},title:"".concat(i?"Served":"Rejected"," at ").concat(e.timestamp,"ms").concat(a?" (In Window)":""),children:a&&i&&(0,r.jsx)("div",{style:{position:"absolute",inset:-1,border:"4px solid purple",opacity:.3}})},e.id)}),(0,r.jsxs)("div",{style:{position:"absolute",top:"2em",left:0,right:0},className:"absolute top-2 left-0 right-0",children:[(0,r.jsx)("div",{style:{position:"absolute",color:"purple",background:"white",left:"".concat(Math.max(10,(s-x-k)*.1),"px"),transform:"translateX(-50%)"},children:"Window Start"}),(0,r.jsx)("div",{style:{position:"absolute",color:"purple",background:"white",top:"2em",left:"".concat((s-k)*.1,"px"),transform:"translateX(-50%)"},children:"Now"})]}),(0,r.jsx)("div",{style:{position:"absolute",top:0,right:0,left:0,display:"flex",justifyContent:"space-evenly"},children:Array.from({length:7},(e,t)=>{let s=k+6e3*t/6;return(0,r.jsxs)("div",{children:[(s/1e3).toFixed(1),"s"]},t)})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{children:"Request Status:"}),(0,r.jsx)("div",{style:{background:"#ffa"},children:(0,r.jsx)("span",{className:"text-green-500",children:"Served"})}),(0,r.jsx)("div",{style:{background:"#faa"},children:(0,r.jsx)("span",{className:"text-red-500",children:"Rejected"})}),(0,r.jsx)("div",{style:{background:"#aafa"},children:(0,r.jsx)("span",{className:"text-purple-500",children:"Current Window"})})]})]}),(0,r.jsxs)("div",{className:d().stats,children:[(0,r.jsxs)(u,{children:[(0,r.jsx)("div",{children:m}),(0,r.jsx)("sub",{children:"Served"})]}),(0,r.jsxs)(u,{children:[(0,r.jsx)("div",{children:v}),(0,r.jsx)("sub",{children:"Rejected"})]}),(0,r.jsxs)(u,{children:[(0,r.jsx)("div",{children:b(s)}),(0,r.jsx)("sub",{children:"In Sliding Window"})]})]})]})};let y=e=>{let{children:t}=e;return(0,r.jsx)("section",{style:{padding:"2em 3em 1em",width:"72vw",maxWidth:"800px",minWidth:"600px"},children:t})};var g=!0,_=(0,i._)(function(){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.Z,{}),(0,r.jsx)(i.Z,{theme:"light",children:(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%",alignItems:"center"},children:[(0,r.jsx)(y,{children:(0,r.jsxs)("label",{children:["Reference:",(0,r.jsx)("a",{href:"https://github.com/Sagyam/tools",target:"__blank",children:"https://github.com/Sagyam/tools"})]})}),(0,r.jsxs)(y,{children:[(0,r.jsx)("h2",{children:"漏水桶"}),(0,r.jsx)("ul",{children:(0,r.jsxs)("li",{children:["当收到请求时：",(0,r.jsxs)("ul",{style:{listStyle:"decimal",padding:"revert"},children:[(0,r.jsxs)("li",{children:["以设定的",(0,r.jsx)("strong",{children:"恒定速率"}),"处理"]}),(0,r.jsx)("li",{children:"如果新请求到达时存储桶已满，则会丢弃该请求"})]})]})}),(0,r.jsx)(m,{})]}),(0,r.jsxs)(y,{children:[(0,r.jsx)("h2",{children:"令牌桶"}),(0,r.jsxs)("ul",{children:[(0,r.jsx)("li",{children:"令牌以固定速率添加到存储桶中"}),(0,r.jsxs)("li",{children:["当收到请求时：",(0,r.jsxs)("ul",{style:{listStyle:"decimal",padding:"revert"},children:[(0,r.jsx)("li",{children:"如果令牌可用，则会将其从存储桶中删除并允许请求"}),(0,r.jsx)("li",{children:"如果没有可用的令牌，则请求将被拒绝或延迟"})]})]})]}),(0,r.jsx)(p,{})]}),(0,r.jsxs)(y,{children:[(0,r.jsx)("h2",{children:"固定窗口"}),(0,r.jsx)("ul",{children:(0,r.jsxs)("li",{children:["当收到请求时：",(0,r.jsxs)("ul",{style:{listStyle:"decimal",padding:"revert"},children:[(0,r.jsx)("li",{children:"计数器跟踪当前窗口中每个客户端/IP 的请求数"}),(0,r.jsx)("li",{children:"如果计数超过限制，则进一步的请求将被拒绝，直到下一个窗口"})]})]})}),(0,r.jsx)(v,{})]}),(0,r.jsxs)(y,{children:[(0,r.jsx)("h2",{children:"滑动窗口"}),(0,r.jsx)("ul",{children:(0,r.jsxs)("li",{children:["当收到请求时：",(0,r.jsxs)("ul",{style:{listStyle:"decimal",padding:"revert"},children:[(0,r.jsx)("li",{children:"计算在过去 X 秒内发出的请求数"}),(0,r.jsx)("li",{children:"如果低于限制，则允许并记录请求"}),(0,r.jsx)("li",{children:"否则，它将被拒绝"})]})]})}),(0,r.jsx)(f,{})]})]})})]})})},9489:function(e){e.exports={btn:"style_btn__AkQj7",subtle:"style_subtle__i70rQ",transparent:"style_transparent__3Brt3"}},5308:function(e){e.exports={"nav-root":"style_nav-root__jrAJR","nav-section":"style_nav-section__sS_tB","nav-menus":"style_nav-menus__4aQM9","nav-trigger":"style_nav-trigger__ekUye","nav-logo":"style_nav-logo__jRYAT","nav-surface":"style_nav-surface__uOpwt",enterFromLeft:"style_enterFromLeft__iqPtr",enterFromRight:"style_enterFromRight__aY5_G",exitToLeft:"style_exitToLeft__60CV1",exitToRight:"style_exitToRight__7aqkb","nav-indicator":"style_nav-indicator__vDtuT",fadeIn:"style_fadeIn__nXtp2",fadeOut:"style_fadeOut__f_kHt","nav-viewport":"style_nav-viewport__YupVO",overviews:"style_overviews__C5KDk",preview:"style_preview__Np_qv",item:"style_item__txBuy"}},3294:function(e){e.exports={root:"style_root__uBCMe",card:"style_card__pYSC1",controls:"style_controls__kQxhG",container:"style_container__cRL60",leakyBucket:"style_leakyBucket___Vm8D",tokensBucket:"style_tokensBucket__VuRYX",request:"style_request__O652Z",stats:"style_stats__vZ35M"}},8216:function(e){e.exports={surface:"styles_surface__5pQP4","soft-surface":"styles_soft-surface__fPrIY","minimum-surface":"styles_minimum-surface__7A9Os"}},110:function(e){e.exports={"in-tooltip":"style_in-tooltip__O2qB1"}}},function(e){e.O(0,[662,653,664,475,888,774,179],function(){return e(e.s=8177)}),_N_E=e.O()}]);